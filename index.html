<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Precision AQ Landing Page Builder</title>
  <link rel="icon" type="image/x-icon" href="Assets/favicon.ico">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Proxima Nova', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      color: #0f1822;
    }
    
    /* Header & Navigation */
    .header {
      position: sticky;
      top: 0;
      background: white;
      padding: 20px 40px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 100;
    }
    .nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }
    .logo {
      height: 40px;
    }
    .menu {
      display: flex;
      gap: 25px;
      flex-wrap: wrap;
    }
    .menu a {
      color: #0f1822;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      transition: color 0.3s;
    }
    .menu a:hover {
      color: #cb009f;
    }
    
    /* Home View */
    .home-view {
      min-height: 100vh;
      background: linear-gradient(135deg, #cb009f 0%, #850064 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
      color: white;
    }
    .home-content {
      text-align: center;
      max-width: 700px;
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .home-title {
      font-size: 56px;
      margin-bottom: 24px;
      font-weight: bold;
      line-height: 1.2;
    }
    .home-desc {
      font-size: 20px;
      margin-bottom: 40px;
      line-height: 1.8;
      opacity: 0.95;
    }
    .home-btn {
      background: white;
      color: #cb009f;
      padding: 18px 48px;
      border: none;
      border-radius: 8px;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .home-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }
    .home-footer {
      margin-top: auto;
      padding: 20px;
      font-size: 14px;
      opacity: 0.7;
    }
    
    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      display: none; /* Changed to none, will be controlled by JS */
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }
    .modal-overlay.active { /* New class to control visibility */
      display: flex;
    }
    .modal-content {
      background: white;
      border-radius: 12px;
      max-width: 90%;
      max-height: 90vh;
      overflow: auto;
      position: relative;
      padding: 40px 20px 20px;
    }
    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      font-size: 20px;
      cursor: pointer;
      font-weight: bold;
      z-index: 1;
    }
    .modal-close:hover {
      background: #c82333;
    }
    .modal-embed { /* This class is no longer directly used but kept for reference */
      width: 100%;
      height: 80vh;
      border: none;
      border-radius: 8px;
    }
    
    /* Icon Picker */
    .icon-picker {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 15px;
      max-height: 400px;
      overflow-y: auto;
      padding: 20px;
    }
    .icon-option {
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
      background: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    .icon-option:hover {
      border-color: #cb009f;
      background: #f8e6f5;
      transform: scale(1.05);
    }
    .icon-option.selected {
      border-color: #cb009f;
      background: #f8e6f5;
    }
    .icon-option img {
      width: 50px;
      height: 50px;
      object-fit: contain;
    }
    .icon-name {
      font-size: 10px;
      color: #666;
      word-break: break-all;
      text-align: center;
    }
    
    /* Builder View */
    .builder-view {
      display: flex;
      height: 100vh;
      background: #f5f5f5;
    }
    .editor-panel {
      width: 45%;
      height: 100vh;
      overflow-y: auto;
      background: white;
      padding: 30px;
      border-right: 2px solid #e0e0e0;
    }
    .editor-header {
      margin-bottom: 30px;
    }
    .editor-title {
      color: #cb009f;
      font-size: 32px;
      margin-bottom: 10px;
    }
    .editor-subtitle {
      color: #666;
      font-size: 14px;
    }
    
    /* Tabs */
    .tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #f0f0f0;
    }
    .tab {
      padding: 12px 20px;
      background: #f5f5f5;
      color: #333;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
    }
    .tab.active {
      background: #cb009f;
      color: white;
    }
    .tab:hover:not(.active) {
      background: #e0e0e0;
    }
    
    /* Form Elements */
    .form-group {
      margin-bottom: 20px;
    }
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 14px;
      color: #333;
    }
    .form-input, .form-textarea, .form-select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit; /* Inherit font from body */
    }
    .form-textarea {
      min-height: 100px;
      resize: vertical;
    }
    .form-checkbox {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }
    
    /* Buttons */
    .btn-primary {
      padding: 12px 24px;
      background: #45b000;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
      transition: all 0.2s;
    }
    .btn-primary:hover {
      background: #3a9500;
    }
    .btn-danger {
      padding: 6px 12px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
    }
    .btn-export {
      width: 100%;
      padding: 18px 40px;
      background: #cb009f;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 18px;
      transition: all 0.3s;
      box-shadow: 0 4px 12px rgba(203, 0, 159, 0.3);
    }
    .btn-export:hover {
      background: #850064;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(203, 0, 159, 0.4);
    }
    
    /* Item Cards */
    .item-card {
      padding: 16px;
      background: #f8f9fa;
      border-radius: 8px;
      margin-bottom: 16px;
      border: 1px solid #e0e0e0;
    }
    .item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    /* Table */
    .custom-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
    }
    .custom-table th,
    .custom-table td {
      padding: 14px;
      border: 1px solid #e0e0e0;
      text-align: left;
    }
    .custom-table th {
      background: #f8f9fa;
      font-size: 13px;
      font-weight: 600;
    }
    .custom-table td {
      font-size: 13px;
    }
    
    /* Preview Panel */
    .preview-panel {
      width: 55%;
      height: 100vh;
      overflow-y: auto;
      background: #fff;
    }
    .preview-header {
      position: sticky;
      top: 0;
      background: white;
      padding: 20px 40px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 10;
    }
    .preview-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }
    .preview-logo {
      height: 40px;
    }
    .preview-menu {
      display: flex;
      gap: 25px;
      flex-wrap: wrap;
    }
    .preview-menu a {
      color: #0f1822;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      transition: color 0.3s;
    }
    .preview-menu a:hover {
      color: #cb009f;
    }
    
    /* Preview Sections */
    .preview-section {
      padding: 80px 40px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .preview-hero {
      background: linear-gradient(135deg, #cb009f 0%, #850064 100%);
      color: white;
      text-align: center;
      max-width: 100%;
    }
    .preview-hero h1 {
      font-size: 48px;
      margin-bottom: 20px;
      font-weight: bold;
    }
    .preview-hero p {
      font-size: 20px;
      margin-bottom: 30px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.6;
    }
    .preview-btn {
      background: white;
      color: #cb009f;
      padding: 14px 32px;
      border-radius: 8px;
      text-decoration: none;
      display: inline-block;
      font-weight: bold;
      font-size: 16px;
    }
    .preview-section h2 {
      font-size: 36px;
      color: #cb009f;
      margin-bottom: 15px;
      font-weight: bold; /* Added for consistency */
    }
    .preview-section .subheading {
      font-size: 18px;
      color: #666;
      margin-bottom: 40px;
      line-height: 1.6;
    }
    
    .team-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 30px;
    }
    .team-card {
      text-align: center;
      padding: 24px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      cursor: pointer;
      transition: all 0.3s;
    }
    .team-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .team-avatar {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: #dcdde1;
      margin: 0 auto 15px;
      overflow: hidden;
    }
    .team-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .team-card h3 {
      color: #cb009f;
      margin-bottom: 5px;
      font-size: 18px;
      font-weight: 600; /* Added for consistency */
    }
    .team-card p {
      color: #666;
      font-size: 14px;
    }
    .team-bio {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #e0e0e0;
      text-align: left;
      font-size: 13px;
      line-height: 1.5;
      color: #666;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease; /* Added 'ease' for smoother transition */
    }
    .team-card.expanded .team-bio {
      max-height: 500px;
    }
    
    .case-studies-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
    }
    .case-study-card {
      padding: 30px;
      background: #f8f9fa;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      cursor: pointer;
      transition: all 0.3s;
    }
    .case-study-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .case-study-card img {
      width: 60px;
      height: 60px;
      margin-bottom: 15px;
      object-fit: contain;
    }
    .case-study-card h3 {
      color: #cb009f;
      margin-bottom: 12px;
      font-size: 20px;
      font-weight: 600; /* Added for consistency */
    }
    .case-study-card p {
      color: #666;
      font-size: 15px;
      line-height: 1.5;
    }
    
    .faq-item {
      margin-bottom: 15px;
      border: 1px solid #dcdde1;
      border-radius: 8px;
      overflow: hidden;
      background: white;
    }
    .faq-question {
      background: #f8f9fa;
      padding: 20px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 15px;
      color: #333;
      transition: background 0.2s; /* Added for smoother hover */
    }
    .faq-question:hover {
      background: #e9ecef;
    }
    .faq-answer {
      padding: 20px;
      font-size: 14px;
      color: #666;
      line-height: 1.6;
      display: none;
    }
    .faq-answer.active {
      display: block;
    }
    
    /* Surprise & Delight - Two Column Layout */
    .surprise-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 60px;
      align-items: center;
      max-width: 1000px;
      margin: 0 auto;
    }
    .surprise-image {
      text-align: center;
    }
    .surprise-image img {
      max-width: 100%;
      max-height: 500px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .surprise-content {
      text-align: left;
    }
    .surprise-content h2 {
      font-size: 36px;
      color: #0f1822;
      margin-bottom: 20px;
      text-align: left;
    }
    .surprise-content p {
      font-size: 16px;
      color: #666;
      line-height: 1.6;
      margin-bottom: 30px;
    }
    .surprise-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .surprise-form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    .surprise-form input {
      width: 100%;
      padding: 14px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit; /* Inherit font from body */
    }
    .surprise-form button {
      padding: 16px;
      background: #cb009f;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }
    .surprise-form button:hover {
      background: #850064;
    }
    
    .hidden { display: none; }
    
    video {
      max-width: 100%;
      border-radius: 12px;
      margin-top: 30px;
    }
    
    @media (max-width: 768px) {
      .hero h1 { font-size: 32px; }
      .hero p { font-size: 16px; }
      .section h2 { font-size: 28px; }
      .surprise-container {
        grid-template-columns: 1fr;
        gap: 30px;
      }
      .surprise-form-row {
        grid-template-columns: 1fr;
      }
      .menu {
        gap: 15px;
      }
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // State management
    const state = {
      view: 'home',
      activeSection: 'hero',
      sections: {
        hero: {
          headline: "Thanks for having us!",
          subheading: "It was an honor and a privilege to be able to be considered for your RFP and the time to share our thinking with you. In case you forgot anything we shared, please have a look around.",
          showButton: true,
          buttonText: "Be in Touch",
          buttonLink: "",
          media: null,
          mediaType: null
        },
        pitch: {
          headline: "What we shared with you",
          subheading: "In case you missed it, here's a refresher of what we shared with you in our presentation",
          media: null,
          mediaType: null
        },
        team: {
          headline: "Meet Your Team",
          subheading: "The folks on your side throughout the work",
          people: []
        },
        caseStudies: {
          headline: "Show Your Work",
          subheading: "We have loads of experience and here are some relevant case studies from our recent work",
          studies: []
        },
        faq: {
          headline: "Learn more about Precision AQ",
          subheading: "additional background on Precision AQ and other things",
          questions: []
        },
        surprise: {
          headline: "Know what's keeping you up at night",
          subheading: "With our partnership, you can sleep easy knowing we have your back. Now, the only thing keeping you up will be the coffee!",
          image: null,
          email: ""
        }
      },
      customization: {
        sectionOrder: ['hero', 'pitch', 'team', 'caseStudies', 'faq', 'surprise'],
        sectionVisibility: {
          hero: true,
          pitch: true,
          team: true,
          caseStudies: true,
          faq: true,
          surprise: true
        },
        sectionNames: {
          hero: 'Hero Header',
          pitch: 'Pitch Materials',
          team: 'Team Bios',
          caseStudies: 'Case Studies',
          faq: 'FAQ',
          surprise: 'Surprise & Delight'
        }
      },
      logoBase64: '',
      teamBiosData: [],
      faqFiles: [],
      availableIcons: [],
      modal: null // This is no longer used for general modals, specific modals are handled directly in export function.
    };

    // Load assets
    async function loadAssets() {
      try {
        // Load logo - ALWAYS
        const logoResponse = await fetch('Assets/PAQ-logo.png');
        if (logoResponse.ok) {
          const logoBlob = await logoResponse.blob();
          state.logoBase64 = await new Promise((resolve) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result);
            reader.readAsDataURL(logoBlob);
          });
        }
        
        // Load default coffee image
        const coffeeResponse = await fetch('Assets/coffee.png');
        if (coffeeResponse.ok) {
          const coffeeBlob = await coffeeResponse.blob();
          state.sections.surprise.image = await new Promise((resolve) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result);
            reader.readAsDataURL(coffeeBlob);
          });
        }
        
        // Load team bios CSV
        const csvResponse = await fetch('Assets/Bios/team-bios.csv');
        if (csvResponse.ok) {
          const csvText = await csvResponse.text();
          state.teamBiosData = parseCSV(csvText);
        }
        
        // Load FAQ files
        try {
          const faqFiles = ['peanuts-faq.json', 'precision-aq-faq.json'];
          for (const file of faqFiles) {
            try {
              const response = await fetch(`Assets/FAQs/${file}`);
              if (response.ok) {
                state.faqFiles.push({ name: file, data: await response.json() });
              }
            } catch (e) {}
          }
        } catch (e) {}
        
        // Load ALL icons from Assets/Icons/
        const iconNames = [
          'Add-Circle-Bold.svg', 'Alarm-Bell-Ring.svg', 'Alert-Bell-Notification-2.svg', 
          'Alert-Octagon-1.svg', 'Ampersand.svg', 'Arrange-Letter.svg', 
          'Arrange-List-Descending.svg', 'Arrange-Number-Descending.svg', 'Attachment.svg',
          'Bill-Cross.svg', 'Bin-1.svg', 'Binocular.svg', 'Blood-Bag-Cross.svg',
          'Book-Close-Bookmark-1.svg', 'Book-Open-Bookmark.svg', 'Bookmark-Cancel-Delete.svg',
          'Bookmarks-Document.svg', 'Branch-Line-5.svg', 'Brightness.svg',
          'Button-Fast-Forward-1.svg', 'Button-Loop.svg', 'Button-Play.svg',
          'Button-Stop.svg', 'Button-Zigzag-1.svg', 'Calendar-3.svg',
          'Calendar-Edit-1.svg', 'Cell-Border-Frame.svg', 'Check-Badge.svg',
          'Check-Double.svg', 'Check-Square.svg', 'Checklist.svg',
          'Checkup-Chart.svg', 'Coding-Apps-Website-Web-Form-Text-Area-1.svg',
          'Cog-Hand-Give-1.svg', 'Cog-Search-1.svg', 'Cog.svg',
          'Command-Button-Keyboard.svg', 'Cursor-Hand-2.svg', 'Cursor-Speed-2.svg',
          'Cursor-Target-1.svg', 'Cursor.svg', 'Delete-2.svg', 'Delete.svg',
          'Diagnostic-Desktop.svg', 'Dial-Finger-1.svg', 'Dial-Pad.svg',
          'Direction-Button-2.svg', 'Direction-Button-3.svg', 'Division-Math-Symbol-Circle.svg',
          'Duplicate.svg', 'Equal-Math-Symbol-Circle.svg', 'Expand-2.svg',
          'Expand-Full.svg', 'Face-Id-1.svg', 'Filter-1.svg',
          'Filter-Sort-Lines-Descending.svg', 'Gauge-Dashboard.svg', 'Hand-Drag.svg',
          'Hospital-Building-Pin.svg', 'Hospital-Sign.svg', 'Insurance-Hand.svg',
          'Insurance-Head.svg', 'Iris-Scan-1.svg', 'Lab-Tube-Experiment.svg',
          'Lab-Tube.svg', 'Lock-Shield.svg', 'Lock-Unlock-4.svg', 'Login-Key.svg',
          'Medical-App-Laptop-1.svg', 'Medical-Specialty-Knee-1.svg', 'Megaphone.svg',
          'Multiple-Users-1.svg', 'Multiple-Users-Network.svg', 'Paper-Write.svg',
          'Pen-Write.svg', 'Pencil-1.svg', 'Petri-Dish-2.svg', 'Plus-One-Increment.svg',
          'Radioactive-Circle.svg', 'Radiology-Scan-Doctor.svg', 'Satellite.svg',
          'Science-Molecule-Strucutre.svg', 'Science-Molecule.svg', 'Search-Circle.svg',
          'Settings-Slider-Desktop-Horizontal.svg', 'Share.svg', 'Shrink.svg',
          'Skull-1.svg', 'Stopwatch.svg', 'Synchronize-Arrows-Three.svg',
          'Tags-Favorite.svg', 'Time-Clock-Fire.svg', 'Time-Daily-1.svg',
          'Tool-Box.svg', 'User-Question.svg', 'User-Signal-1.svg',
          'View-Square.svg', 'Voice-Id-Approved.svg', 'Voice-Id.svg', 'Wifi-Signal-2.svg'
        ];
        
        state.availableIcons = iconNames;
        
      } catch (e) {
        console.log('Some assets not found');
      }
      render();
    }

    function parseCSV(text) {
      const lines = text.trim().split('\n');
      const headers = lines[0].split(',').map(h => h.trim());
      return lines.slice(1).map(line => {
        const values = line.split(',');
        return headers.reduce((obj, header, index) => {
          obj[header] = values[index]?.trim() || '';
          return obj;
        }, {});
      });
    }

    async function handleFileUpload(file) {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result);
        reader.readAsDataURL(file);
      });
    }

    function updateSection(sectionKey, field, value) {
      state.sections[sectionKey][field] = value;
      render();
    }

    function openModal(content) { // This function is no longer directly used in the builder, modal logic is in export and preview rendering.
      state.modal = content;
      render();
    }

    function closeModal() { // This function is no longer directly used.
      state.modal = null;
      render();
    }

    // Render functions
    function renderHome() {
      return `
        <div class="home-view">
          <div class="home-content">
            <h1 class="home-title">Precision AQ<br/>Landing Page Builder</h1>
            <p class="home-desc">
              Create customized landing pages for your RFP responses with an intuitive interface. Export as a single, self-contained HTML file.
            </p>
            <button class="home-btn" onclick="state.view='builder'; render();">
              Start A Project
            </button>
          </div>
          <div class="home-footer">Built by Jack</div>
        </div>
      `;
    }

    function renderBuilder() {
      return `
        <div class="builder-view">
          ${renderEditorPanel()}
          ${renderPreviewPanel()}
        </div>
        ${state.modal ? renderModal() : ''} 
      `;
    }

    // This renderModal function is effectively replaced by inline modal rendering in exportWebsite and within renderPreviewSection for pitch/case studies.
    function renderModal() { 
      return `
        <div class="modal-overlay" onclick="if(event.target === this) closeModal();">
          <div class="modal-content">
            <button class="modal-close" onclick="closeModal();">Ã—</button>
            ${state.modal}
          </div>
        </div>
      `;
    }

    function renderEditorPanel() {
      return `
        <div class="editor-panel">
          <div class="editor-header">
            <h2 class="editor-title">Website Builder</h2>
            <p class="editor-subtitle">Edit your landing page sections below</p>
          </div>
          ${renderTabs()}
          ${renderActiveEditor()}
        </div>
      `;
    }

    function renderTabs() {
      const tabs = ['hero', 'pitch', 'team', 'caseStudies', 'faq', 'surprise', 'customization'];
      return `
        <div class="tabs">
          ${tabs.map(tab => `
            <button class="tab ${state.activeSection === tab ? 'active' : ''}" 
                    onclick="state.activeSection='${tab}'; render();">
              ${tab === 'customization' ? 'Customize & Export' : state.customization.sectionNames[tab]}
            </button>
          `).join('')}
        </div>
      `;
    }

    function renderActiveEditor() {
      switch(state.activeSection) {
        case 'hero': return renderHeroEditor();
        case 'pitch': return renderPitchEditor();
        case 'team': return renderTeamEditor();
        case 'caseStudies': return renderCaseStudiesEditor();
        case 'faq': return renderFaqEditor();
        case 'surprise': return renderSurpriseEditor();
        case 'customization': return renderCustomizationEditor();
        default: return '';
      }
    }

    function renderHeroEditor() {
      const section = state.sections.hero;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Hero Section</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}" 
                   onblur="updateSection('hero', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea" 
                      onblur="updateSection('hero', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" class="form-checkbox" ${section.showButton ? 'checked' : ''}
                     onchange="updateSection('hero', 'showButton', this.checked);">
              <span>Show Call-to-Action Button</span>
            </label>
          </div>
          
          ${section.showButton ? `
            <div class="form-group">
              <label class="form-label">Button Text</label>
              <input type="text" class="form-input" value="${section.buttonText}"
                     onblur="updateSection('hero', 'buttonText', this.value);">
            </div>
            
            <div class="form-group">
              <label class="form-label">Button Link URL</label>
              <input type="url" class="form-input" value="${section.buttonLink}" placeholder="https://example.com"
                     onblur="updateSection('hero', 'buttonLink', this.value);">
            </div>
          ` : ''}
          
          <div class="form-group">
            <label class="form-label">Hero Image/Video (.mp4)</label>
            <input type="file" class="form-input" accept="image/*,video/mp4"
                   onchange="handleHeroMedia(this);">
            ${section.media ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ Media uploaded</p>' : ''}
          </div>
        </div>
      `;
    }

    async function handleHeroMedia(input) {
      if (input.files[0]) {
        const file = input.files[0];
        const base64 = await handleFileUpload(file);
        state.sections.hero.media = base64;
        state.sections.hero.mediaType = file.type;
        render();
      }
    }

    function renderPitchEditor() {
      const section = state.sections.pitch;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Pitch Materials</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('pitch', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('pitch', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">Presentation Materials (PDF or PowerPoint only)</label>
            <input type="file" class="form-input" accept=".pdf,.ppt,.pptx"
                   onchange="handlePitchMedia(this);">
            ${section.media ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ File uploaded</p>' : ''}
          </div>
        </div>
      `;
    }

    async function handlePitchMedia(input) {
      if (input.files[0]) {
        const file = input.files[0];
        const base64 = await handleFileUpload(file);
        state.sections.pitch.media = base64;
        state.sections.pitch.mediaType = file.type;
        render();
      }
    }

    function renderTeamEditor() {
      const section = state.sections.team;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Team Bios</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('team', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('team', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          <div style="margin-bottom: 20px;">
            <h4 style="margin-bottom: 16px; font-size: 16px; font-weight: 600;">Team Members (${section.people.length}/10)</h4>
            ${section.people.map((person, idx) => `
              <div class="item-card">
                <div class="item-header">
                  <strong>${person.name || `Person ${idx + 1}`}</strong>
                  <button class="btn-danger" onclick="removeTeamMember(${idx});">Remove</button>
                </div>
                
                ${state.teamBiosData.length > 0 ? `
                  <div class="form-group">
                    <label class="form-label">Select Team Member from CSV</label>
                    <select class="form-select" onchange="loadTeamBio(${idx}, this.value);">
                      <option value="">-- Choose a team member --</option>
                      ${state.teamBiosData.map(bio => `
                        <option value="${bio.Name}" ${person.csvId === bio.Name ? 'selected' : ''}>
                          ${bio.Name}
                        </option>
                      `).join('')}
                    </select>
                  </div>
                ` : ''}
                
                <div class="form-group">
                  <label class="form-label">Name</label>
                  <input type="text" class="form-input" value="${person.name || ''}" placeholder="Name"
                         onblur="state.sections.team.people[${idx}].name = this.value; render();">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Title</label>
                  <input type="text" class="form-input" value="${person.title || ''}" placeholder="Title"
                         onblur="state.sections.team.people[${idx}].title = this.value; render();">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Bio</label>
                  <textarea class="form-textarea" placeholder="Bio text..."
                            onblur="state.sections.team.people[${idx}].bio = this.value; render();">${person.bio || ''}</textarea>
                </div>
                
                <div class="form-group">
                  <label class="form-label">LinkedIn URL</label>
                  <input type="url" class="form-input" value="${person.linkedin || ''}" placeholder="https://linkedin.com/in/..."
                         onblur="state.sections.team.people[${idx}].linkedin = this.value; render();">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Photo</label>
                  <input type="file" class="form-input" accept="image/*"
                         onchange="uploadTeamPhoto(${idx}, this);">
                  ${person.image ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ Photo uploaded</p>' : ''}
                </div>
              </div>
            `).join('')}
            
            ${section.people.length < 10 ? `
              <button class="btn-primary" onclick="addTeamMember();">+ Add Team Member</button>
            ` : ''}
          </div>
        </div>
      `;
    }

    function addTeamMember() {
      state.sections.team.people.push({ name: '', title: '', bio: '', image: null, linkedin: '', csvId: null }); // Added csvId
      render();
    }

    function removeTeamMember(idx) {
      state.sections.team.people.splice(idx, 1);
      render();
    }

    async function loadTeamBio(idx, name) {
      const bio = state.teamBiosData.find(b => b.Name === name);
      if (bio) {
        const person = state.sections.team.people[idx];
        person.name = bio.Name;
        person.title = bio.Title;
        person.bio = bio.Bio;
        person.linkedin = bio.LinkedIn;
        person.csvId = bio.Name; // Store csvId to identify loaded members
        
        // Load image from Assets/Bios/bio-images/
        if (bio.Image) {
          try {
            const imgResponse = await fetch(`Assets/Bios/bio-images/${bio.Image}`);
            if (imgResponse.ok) {
              const imgBlob = await imgResponse.blob();
              person.image = await new Promise((resolve) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.readAsDataURL(imgBlob);
              });
            }
          } catch (e) {
            console.log('Image not found:', e); // Log error for debugging
          }
        }
        render();
      }
    }

    async function uploadTeamPhoto(idx, input) {
      if (input.files[0]) {
        const base64 = await handleFileUpload(input.files[0]);
        state.sections.team.people[idx].image = base64;
        state.sections.team.people[idx].csvId = null; // Clear csvId if manual upload overwrites it
        render();
      }
    }

    function renderCaseStudiesEditor() {
      const section = state.sections.caseStudies;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Case Studies</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('caseStudies', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('caseStudies', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          ${section.studies.map((study, idx) => `
            <div class="item-card">
              <div class="item-header">
                <strong>Case Study ${idx + 1}</strong>
                <button class="btn-danger" onclick="removeCaseStudy(${idx});">Remove</button>
              </div>
              
              <div class="form-group">
                <label class="form-label">Heading</label>
                <input type="text" class="form-input" value="${study.heading || ''}" placeholder="Heading"
                       onblur="state.sections.caseStudies.studies[${idx}].heading = this.value; render();">
              </div>
              
              <div class="form-group">
                <label class="form-label">Description</label>
                <textarea class="form-textarea" placeholder="Description"
                          onblur="state.sections.caseStudies.studies[${idx}].subheading = this.value; render();">${study.subheading || ''}</textarea>
              </div>
              
              <div class="form-group">
                <label class="form-label">Case Study File (PDF, Image, Video)</label>
                <input type="file" class="form-input" accept=".pdf,image/*,video/*"
                       onchange="uploadCaseFile(${idx}, this);">
                ${study.file ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ File uploaded</p>' : ''}
              </div>
              
              <div class="form-group">
                <label class="form-label">Icon</label>
                <button class="btn-primary" onclick="showIconPicker(${idx});" style="width: auto;">Choose Icon</button>
                ${study.icon ? `
                  <div style="margin-top: 10px; display: flex; align-items: center; gap: 10px;">
                    <img src="${study.icon}" style="width: 40px; height: 40px; object-fit: contain;">
                    <span style="font-size: 12px; color: #45b000;">âœ“ Icon selected</span>
                  </div>
                ` : ''}
              </div>
            </div>
          `).join('')}
          
          ${section.studies.length < 6 ? `
            <button class="btn-primary" onclick="addCaseStudy();">Add Case Study</button>
          ` : ''}
        </div>
      `;
    }

    function addCaseStudy() {
      state.sections.caseStudies.studies.push({ 
        id: Date.now(), 
        heading: '', 
        subheading: '', 
        icon: '',
        file: null,
        fileType: null 
      });
      render();
    }

    function removeCaseStudy(idx) {
      state.sections.caseStudies.studies.splice(idx, 1);
      render();
    }

    async function uploadCaseFile(idx, input) {
      if (input.files[0]) {
        const file = input.files[0];
        const base64 = await handleFileUpload(file);
        state.sections.caseStudies.studies[idx].file = base64;
        state.sections.caseStudies.studies[idx].fileType = file.type;
        render();
      }
    }

    function showIconPicker(idx) {
      const iconGrid = state.availableIcons.map((iconName) => `
        <div class="icon-option" onclick="selectIcon(${idx}, 'Assets/Icons/${iconName}');">
          <img src="Assets/Icons/${iconName}" alt="${iconName}">
          <div class="icon-name">${iconName.replace('.svg', '').replace(/-/g, ' ')}</div>
        </div>
      `).join('');
      
      openModal(`
        <h3 style="margin-bottom: 20px; text-align: center;">Select an Icon</h3>
        <div class="icon-picker">
          ${iconGrid}
        </div>
      `);
    }

    function selectIcon(idx, iconPath) {
      state.sections.caseStudies.studies[idx].icon = iconPath;
      closeModal();
      render();
    }

    function renderFaqEditor() {
      const section = state.sections.faq;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">FAQ</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('faq', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('faq', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          ${state.faqFiles.length > 0 ? `
            <div class="form-group">
              <label class="form-label">Load Pre-built FAQ Set</label>
              <select class="form-select" onchange="loadFAQSet(this.value);">
                <option value="">-- Choose an FAQ set --</option>
                ${state.faqFiles.map(file => `
                  <option value="${file.name}">${file.name.replace('.json', '').replace(/-/g, ' ')}</option>
                `).join('')}
              </select>
              <p style="font-size: 12px; color: #666; margin-top: 6px;">Select a pre-built FAQ to populate questions below</p>
            </div>
          ` : ''}
          
          ${section.questions.map((q, idx) => `
            <div class="item-card">
              <div class="item-header">
                <strong>Question ${idx + 1}</strong>
                <button class="btn-danger" onclick="removeFAQ(${idx});">Remove</button>
              </div>
              
              <div class="form-group">
                <label class="form-label">Question</label>
                <input type="text" class="form-input" value="${q.question || ''}" placeholder="Question"
                       onblur="state.sections.faq.questions[${idx}].question = this.value; render();">
              </div>
              
              <div class="form-group">
                <label class="form-label">Answer</label>
                <textarea class="form-textarea" placeholder="Answer"
                          onblur="state.sections.faq.questions[${idx}].answer = this.value; render();">${q.answer || ''}</textarea>
              </div>
            </div>
          `).join('')}
          
          ${section.questions.length < 10 ? `
            <button class="btn-primary" onclick="addFAQ();">Add FAQ Question</button>
          ` : ''}
        </div>
      `;
    }

    function loadFAQSet(fileName) {
      if (!fileName) return;
      const faqFile = state.faqFiles.find(f => f.name === fileName);
      if (faqFile && faqFile.data) {
        // Handle different JSON structures
        let questions = [];
        if (Array.isArray(faqFile.data)) { // If the root is an array of questions
            questions = faqFile.data.map(q => ({ question: q.question, answer: q.answer }));
        } else if (faqFile.data.questions) { // Standard structure with a 'questions' key
          questions = faqFile.data.questions;
        } else if (faqFile.data.faqVersion && faqFile.data.faqVersion.questions) { // Nested structure
          questions = faqFile.data.faqVersion.questions;
        } else {
          // Try to find questions array in any nested object
          const values = Object.values(faqFile.data);
          for (const val of values) {
            if (val && Array.isArray(val.questions)) { // Check if it's an array of questions
              questions = val.questions;
              break;
            }
          }
        }
        
        state.sections.faq.questions = questions.map(q => ({
          question: q.question || '',
          answer: q.answer || ''
        }));
        render();
      }
    }

    function addFAQ() {
      state.sections.faq.questions.push({ question: '', answer: '' });
      render();
    }

    function removeFAQ(idx) {
      state.sections.faq.questions.splice(idx, 1);
      render();
    }

    function renderSurpriseEditor() {
      const section = state.sections.surprise;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Surprise & Delight</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('surprise', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('surprise', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">Fulfillment Email</label>
            <input type="email" class="form-input" value="${section.email}" placeholder="fulfillment@precisionaq.com"
                   onblur="updateSection('surprise', 'email', this.value);">
            <p style="font-size: 12px; color: #666; margin-top: 6px;">Requests will be sent to this email address</p>
          </div>
          
          <div class="form-group">
            <label class="form-label">Feature Image (Default: coffee.png)</label>
            <input type="file" class="form-input" accept="image/*"
                   onchange="uploadSurpriseImage(this);">
            ${section.image ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ Image uploaded</p>' : ''}
          </div>
        </div>
      `;
    }

    async function uploadSurpriseImage(input) {
      if (input.files[0]) {
        const base64 = await handleFileUpload(input.files[0]);
        state.sections.surprise.image = base64;
        render();
      }
    }

    function renderCustomizationEditor() {
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Customize & Export</h3>
          <p style="margin-bottom: 20px; color: #666; font-size: 14px;">Control which sections appear on your landing page and their order.</p>
          
          <table class="custom-table">
            <thead>
              <tr>
                <th>Section Name</th>
                <th style="text-align: center;">Visible</th>
                <th style="text-align: center;">Order</th>
              </tr>
            </thead>
            <tbody>
              ${state.customization.sectionOrder.map((key, idx) => `
                <tr>
                  <td>
                    <input type="text" class="form-input" value="${state.customization.sectionNames[key]}"
                           onblur="state.customization.sectionNames['${key}'] = this.value; render();">
                  </td>
                  <td style="text-align: center;">
                    <input type="checkbox" class="form-checkbox" 
                           ${state.customization.sectionVisibility[key] ? 'checked' : ''}
                           onchange="state.customization.sectionVisibility['${key}'] = this.checked; render();">
                  </td>
                  <td style="text-align: center;">
                    <button ${idx === 0 ? 'disabled' : ''} 
                            style="margin: 0 4px; padding: 6px 10px; cursor: ${idx === 0 ? 'not-allowed' : 'pointer'}; border: 1px solid #ddd; background: ${idx === 0 ? '#f5f5f5' : 'white'}; border-radius: 4px;"
                            onclick="moveSection(${idx}, -1);">â–²</button>
                    <button ${idx === state.customization.sectionOrder.length - 1 ? 'disabled' : ''}
                            style="margin: 0 4px; padding: 6px 10px; cursor: ${idx === state.customization.sectionOrder.length - 1 ? 'not-allowed' : 'pointer'}; border: 1px solid #ddd; background: ${idx === state.customization.sectionOrder.length - 1 ? '#f5f5f5' : 'white'}; border-radius: 4px;"
                            onclick="moveSection(${idx}, 1);">â–¼</button>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
          
          <button class="btn-export" onclick="exportWebsite();">ðŸ“¥ Export Landing Page</button>
          <p style="margin-top: 16px; font-size: 13px; color: #666; text-align: center;">
            Downloads a single, self-contained HTML file
          </p>
        </div>
      `;
    }

    function moveSection(idx, direction) {
      const newIdx = idx + direction;
      if (newIdx >= 0 && newIdx < state.customization.sectionOrder.length) {
        [state.customization.sectionOrder[idx], state.customization.sectionOrder[newIdx]] = 
        [state.customization.sectionOrder[newIdx], state.customization.sectionOrder[idx]];
        render();
      }
    }

    function renderPreviewPanel() {
      const visibleSections = state.customization.sectionOrder.filter(
        key => state.customization.sectionVisibility[key]
      );
      
      return `
        <div class="preview-panel">
          <div class="preview-header">
            <div class="nav">
              <img src="${state.logoBase64}" alt="Precision AQ" class="logo">
              <div class="menu">
                ${visibleSections.map(key => `
                  <a href="#${key}" onclick="event.preventDefault(); document.getElementById('${key}').scrollIntoView({behavior: 'smooth'});">
                    ${state.customization.sectionNames[key]}
                  </a>
                `).join('')}
              </div>
            </div>
          </div>
          
          ${visibleSections.map(key => renderPreviewSection(key)).join('')}
        </div>
      `;
    }

    function renderPreviewSection(key) {
      const section = state.sections[key];
      
      switch(key) {
        case 'hero':
          return `
            <div id="hero" class="section preview-section hero">
              <h1>${section.headline}</h1>
              <p>${section.subheading}</p>
              ${section.showButton ? `
                <a href="${section.buttonLink || '#'}" class="preview-btn btn" target="_blank" rel="noopener">
                  ${section.buttonText}
                </a>
              ` : ''}
              ${section.media ? 
                (section.mediaType?.startsWith('video') ? 
                  `<video controls style="max-width: 90%; margin-top: 40px;"><source src="${section.media}" type="${section.mediaType}"></video>` :
                  `<div style="margin-top: 40px;"><img src="${section.media}" alt="Hero" style="max-width: 90%; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.3);"></div>`
                ) : ''
              }
            </div>
          `;
          
        case 'pitch':
          return `
            <div id="pitch" class="section preview-section">
              <h2>${section.headline}</h2>
              <p class="subheading">${section.subheading}</p>
              ${section.media ? `
                <div style="text-align: center; margin-top: 30px;">
                  <button class="btn-primary" onclick="openModal('pitch');" style="cursor: pointer; border: none; font-family: inherit;">
                    ðŸ“„ View Presentation
                  </button>
                </div>
                <div id="modal-pitch" class="modal-overlay" onclick="if(event.target === this) closeModal('pitch');">
                  <div class="modal-content">
                    <button class="modal-close" onclick="closeModal('pitch');">Ã—</button>
                    <embed src="${section.media}" type="${section.mediaType || 'application/pdf'}" style="width: 100%; height: 85vh;" />
                  </div>
                </div>
              ` : ''}
            </div>
          `;
          
        case 'team':
          if (section.people.length === 0) return '';
          return `
            <div id="team" class="section preview-section" style="background: #f8f9fa;">
              <h2>${section.headline}</h2>
              <p class="subheading">${section.subheading}</p>
              <div class="team-grid">
                ${section.people.map((person, idx) => `
                  <div class="team-card" id="team-card-${idx}" onclick="this.classList.toggle('expanded');">
                    <div class="team-avatar">
                      ${person.image ? `<img src="${person.image}" alt="${person.name}">` : ''}
                    </div>
                    <h3>${person.name}</h3>
                    <p>${person.title}</p>
                    ${person.linkedin ? `<a href="${person.linkedin}" target="_blank" onclick="event.stopPropagation();" style="color: #cb009f; font-size: 14px; text-decoration: none; margin-top: 10px; display: inline-block;">LinkedIn â†’</a>` : ''}
                    ${person.bio ? `
                      <div class="team-bio">
                        <strong style="display: block; margin-bottom: 8px; color: #333;">About:</strong>
                        ${person.bio}
                      </div>
                    ` : ''}
                  </div>
                `).join('')}
              </div>
              <p style="text-align: center; margin-top: 20px; font-size: 14px; color: #666; font-style: italic;">Click on a team member to read their bio</p>
            </div>
          `;
          
        case 'caseStudies':
          if (section.studies.length === 0 || !section.studies.some(s => s.heading)) return '';
          return `
            <div id="caseStudies" class="section preview-section">
              <h2>${section.headline}</h2>
              <p class="subheading">${section.subheading}</p>
              <div class="case-studies-grid">
                ${section.studies.filter(s => s.heading).map((study, idx) => `
                  <div class="case-study-card" ${study.file ? `onclick="openModal('case-${idx}');"` : ''}>
                    ${study.icon ? `<img src="${study.icon}" alt="Icon">` : ''}
                    <h3>${study.heading}</h3>
                    <p>${study.subheading}</p>
                  </div>
                  ${study.file ? `
                    <div id="modal-case-${idx}" class="modal-overlay" onclick="if(event.target === this) closeModal('case-${idx}');">
                      <div class="modal-content">
                        <button class="modal-close" onclick="closeModal('case-${idx}');">Ã—</button>
                        <embed src="${study.file}" type="${study.fileType || 'application/pdf'}" style="width: 100%; height: 85vh;" />
                      </div>
                    </div>
                  ` : ''}
                `).join('')}
              </div>
            </div>
          `;
          
        case 'faq':
          if (section.questions.length === 0) return '';
          return `
            <div id="faq" class="section preview-section" style="background: #f8f9fa;">
              <h2>${section.headline}</h2>
              <p class="subheading">${section.subheading}</p>
              ${section.questions.map((q, idx) => `
                <div class="faq-item">
                  <div class="faq-question" onclick="toggleFAQ(${idx});">
                    ${q.question}
                    <span id="faq-icon-${idx}">â–¼</span>
                  </div>
                  <div class="faq-answer" id="faq-answer-${idx}">${q.answer}</div>
                </div>
              `).join('')}
            </div>
          `;
          
        case 'surprise':
          return `
            <div id="surprise" class="section preview-section">
              <div class="surprise-container">
                <div class="surprise-image">
                  ${section.image ? `<img src="${section.image}" alt="Coffee">` : ''}
                </div>
                <div class="surprise-content">
                  <h2>${section.headline}</h2>
                  <p>${section.subheading}</p>
                  <div class="surprise-form">
                    <div class="surprise-form-row">
                      <input type="text" placeholder="First Name" id="surprise-first">
                      <input type="text" placeholder="Last Name" id="surprise-last">
                    </div>
                    <input type="email" placeholder="Email Address" id="surprise-email">
                    <button onclick="submitSurpriseForm();">Give Me Coffee</button>
                  </div>
                </div>
              </div>
            </div>
          `;
          
        default:
          return '';
      }
    }

    // Export functionality
    function exportWebsite() {
      const visibleSections = state.customization.sectionOrder.filter(
        key => state.customization.sectionVisibility[key]
      );
      
      const exportHTML = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${state.sections.hero.headline} - Precision AQ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Proxima Nova', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      color: #0f1822;
    }
    
    .header {
      position: sticky;
      top: 0;
      background: white;
      padding: 20px 40px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 100;
    }
    .nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }
    .logo {
      height: 40px;
    }
    .menu {
      display: flex;
      gap: 25px;
      flex-wrap: wrap;
    }
    .menu a {
      color: #0f1822;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      transition: color 0.3s;
    }
    .menu a:hover {
      color: #cb009f;
    }
    
    .section {
      padding: 80px 40px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .hero {
      background: linear-gradient(135deg, #cb009f 0%, #850064 100%);
      color: white;
      text-align: center;
      max-width: 100%;
    }
    .hero h1 {
      font-size: 48px;
      margin-bottom: 20px;
      font-weight: bold;
      line-height: 1.2;
    }
    .hero p {
      font-size: 20px;
      margin-bottom: 30px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.6;
    }
    .btn { /* Consolidated button style */
      background: white;
      color: #cb009f;
      padding: 14px 32px;
      border-radius: 8px;
      text-decoration: none;
      display: inline-block;
      font-weight: bold;
      font-size: 16px;
      transition: all 0.3s;
      cursor: pointer; /* Added cursor for non-link buttons */
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .section h2 {
      font-size: 36px;
      color: #cb009f;
      margin-bottom: 15px;
      font-weight: bold;
    }
    .section .subheading {
      font-size: 18px;
      color: #666;
      margin-bottom: 40px;
      line-height: 1.6;
    }
    
    .team-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 30px;
    }
    .team-card {
      text-align: center;
      padding: 24px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      cursor: pointer;
      transition: all 0.3s;
    }
    .team-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .team-avatar {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: #dcdde1;
      margin: 0 auto 15px;
      overflow: hidden;
    }
    .team-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .team-card h3 {
      color: #cb009f;
      margin-bottom: 5px;
      font-size: 18px;
      font-weight: 600;
    }
    .team-card p {
      color: #666;
      font-size: 14px;
    }
    .team-bio {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #e0e0e0;
      text-align: left;
      font-size: 13px;
      line-height: 1.5;
      color: #666;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .team-card.expanded .team-bio {
      max-height: 500px;
    }
    
    .case-studies-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
    }
    .case-study-card {
      padding: 30px;
      background: #f8f9fa;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      cursor: pointer;
      transition: all 0.3s;
    }
    .case-study-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .case-study-card img {
      width: 60px;
      height: 60px;
      margin-bottom: 15px;
      object-fit: contain;
    }
    .case-study-card h3 {
      color: #cb009f;
      margin-bottom: 12px;
      font-size: 20px;
      font-weight: 600;
    }
    .case-study-card p {
      color: #666;
      font-size: 15px;
      line-height: 1.5;
    }
    
    .faq-item {
      margin-bottom: 15px;
      border: 1px solid #dcdde1;
      border-radius: 8px;
      overflow: hidden;
      background: white;
    }
    .faq-question {
      background: #f8f9fa;
      padding: 20px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 15px;
      color: #333;
      transition: background 0.2s;
    }
    .faq-question:hover {
      background: #e9ecef;
    }
    .faq-answer {
      padding: 20px;
      font-size: 14px;
      color: #666;
      line-height: 1.6;
      display: none;
    }
    .faq-answer.active {
      display: block;
    }
    
    .surprise-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 60px;
      align-items: center;
      max-width: 1000px;
      margin: 0 auto;
    }
    .surprise-image {
      text-align: center;
    }
    .surprise-image img {
      max-width: 100%;
      max-height: 500px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .surprise-content {
      text-align: left;
    }
    .surprise-content h2 {
      font-size: 36px;
      color: #0f1822;
      margin-bottom: 20px;
      text-align: left;
    }
    .surprise-content p {
      font-size: 16px;
      color: #666;
      line-height: 1.6;
      margin-bottom: 30px;
    }
    .surprise-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .surprise-form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    .surprise-form input {
      width: 100%;
      padding: 14px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
    }
    .surprise-form button {
      padding: 16px;
      background: #cb009f;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }
    .surprise-form button:hover {
      background: #850064;
    }
    
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      display: none; /* Default hidden */
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }
    .modal-overlay.active {
      display: flex; /* Shown when active class is added */
    }
    .modal-content {
      background: white;
      border-radius: 12px;
      max-width: 90%;
      max-height: 90vh;
      overflow: auto;
      position: relative;
      padding: 40px 20px 20px;
    }
    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      font-size: 20px;
      cursor: pointer;
      font-weight: bold;
      z-index: 1;
    }
    .modal-close:hover {
      background: #c82333;
    }
    
    video {
      max-width: 100%;
      border-radius: 12px;
      margin-top: 30px;
    }
    
    @media (max-width: 768px) {
      .hero h1 { font-size: 32px; }
      .hero p { font-size: 16px; }
      .section h2 { font-size: 28px; }
      .surprise-container {
        grid-template-columns: 1fr;
        gap: 30px;
      }
      .surprise-form-row {
        grid-template-columns: 1fr;
      }
      .menu {
        gap: 15px;
      }
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // State management
    const state = {
      view: 'home',
      activeSection: 'hero',
      sections: {
        hero: {
          headline: "Thanks for having us!",
          subheading: "It was an honor and a privilege to be able to be considered for your RFP and the time to share our thinking with you. In case you forgot anything we shared, please have a look around.",
          showButton: true,
          buttonText: "Be in Touch",
          buttonLink: "",
          media: null,
          mediaType: null
        },
        pitch: {
          headline: "What we shared with you",
          subheading: "In case you missed it, here's a refresher of what we shared with you in our presentation",
          media: null,
          mediaType: null
        },
        team: {
          headline: "Meet Your Team",
          subheading: "The folks on your side throughout the work",
          people: []
        },
        caseStudies: {
          headline: "Show Your Work",
          subheading: "We have loads of experience and here are some relevant case studies from our recent work",
          studies: []
        },
        faq: {
          headline: "Learn more about Precision AQ",
          subheading: "additional background on Precision AQ and other things",
          questions: []
        },
        surprise: {
          headline: "Know what's keeping you up at night",
          subheading: "With our partnership, you can sleep easy knowing we have your back. Now, the only thing keeping you up will be the coffee!",
          image: null,
          email: ""
        }
      },
      customization: {
        sectionOrder: ['hero', 'pitch', 'team', 'caseStudies', 'faq', 'surprise'],
        sectionVisibility: {
          hero: true,
          pitch: true,
          team: true,
          caseStudies: true,
          faq: true,
          surprise: true
        },
        sectionNames: {
          hero: 'Hero Header',
          pitch: 'Pitch Materials',
          team: 'Team Bios',
          caseStudies: 'Case Studies',
          faq: 'FAQ',
          surprise: 'Surprise & Delight'
        }
      },
      logoBase64: '',
      teamBiosData: [],
      faqFiles: [],
      availableIcons: [],
      modal: null 
    };

    // Load assets
    async function loadAssets() {
      try {
        const logoResponse = await fetch('Assets/PAQ-logo.png');
        if (logoResponse.ok) {
          const logoBlob = await logoResponse.blob();
          state.logoBase64 = await new Promise((resolve) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result);
            reader.readAsDataURL(logoBlob);
          });
        }
        
        const coffeeResponse = await fetch('Assets/coffee.png');
        if (coffeeResponse.ok) {
          const coffeeBlob = await coffeeResponse.blob();
          state.sections.surprise.image = await new Promise((resolve) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result);
            reader.readAsDataURL(coffeeBlob);
          });
        }
        
        const csvResponse = await fetch('Assets/Bios/team-bios.csv');
        if (csvResponse.ok) {
          const csvText = await csvResponse.text();
          state.teamBiosData = parseCSV(csvText);
        }
        
        try {
          const faqFiles = ['peanuts-faq.json', 'precision-aq-faq.json'];
          for (const file of faqFiles) {
            try {
              const response = await fetch(`Assets/FAQs/${file}`);
              if (response.ok) {
                state.faqFiles.push({ name: file, data: await response.json() });
              }
            } catch (e) {}
          }
        } catch (e) {}
        
        const iconNames = [
          'Add-Circle-Bold.svg', 'Alarm-Bell-Ring.svg', 'Alert-Bell-Notification-2.svg', 
          'Alert-Octagon-1.svg', 'Ampersand.svg', 'Arrange-Letter.svg', 
          'Arrange-List-Descending.svg', 'Arrange-Number-Descending.svg', 'Attachment.svg',
          'Bill-Cross.svg', 'Bin-1.svg', 'Binocular.svg', 'Blood-Bag-Cross.svg',
          'Book-Close-Bookmark-1.svg', 'Book-Open-Bookmark.svg', 'Bookmark-Cancel-Delete.svg',
          'Bookmarks-Document.svg', 'Branch-Line-5.svg', 'Brightness.svg',
          'Button-Fast-Forward-1.svg', 'Button-Loop.svg', 'Button-Play.svg',
          'Button-Stop.svg', 'Button-Zigzag-1.svg', 'Calendar-3.svg',
          'Calendar-Edit-1.svg', 'Cell-Border-Frame.svg', 'Check-Badge.svg',
          'Check-Double.svg', 'Check-Square.svg', 'Checklist.svg',
          'Checkup-Chart.svg', 'Coding-Apps-Website-Web-Form-Text-Area-1.svg',
          'Cog-Hand-Give-1.svg', 'Cog-Search-1.svg', 'Cog.svg',
          'Command-Button-Keyboard.svg', 'Cursor-Hand-2.svg', 'Cursor-Speed-2.svg',
          'Cursor-Target-1.svg', 'Cursor.svg', 'Delete-2.svg', 'Delete.svg',
          'Diagnostic-Desktop.svg', 'Dial-Finger-1.svg', 'Dial-Pad.svg',
          'Direction-Button-2.svg', 'Direction-Button-3.svg', 'Division-Math-Symbol-Circle.svg',
          'Duplicate.svg', 'Equal-Math-Symbol-Circle.svg', 'Expand-2.svg',
          'Expand-Full.svg', 'Face-Id-1.svg', 'Filter-1.svg',
          'Filter-Sort-Lines-Descending.svg', 'Gauge-Dashboard.svg', 'Hand-Drag.svg',
          'Hospital-Building-Pin.svg', 'Hospital-Sign.svg', 'Insurance-Hand.svg',
          'Insurance-Head.svg', 'Iris-Scan-1.svg', 'Lab-Tube-Experiment.svg',
          'Lab-Tube.svg', 'Lock-Shield.svg', 'Lock-Unlock-4.svg', 'Login-Key.svg',
          'Medical-App-Laptop-1.svg', 'Medical-Specialty-Knee-1.svg', 'Megaphone.svg',
          'Multiple-Users-1.svg', 'Multiple-Users-Network.svg', 'Paper-Write.svg',
          'Pen-Write.svg', 'Pencil-1.svg', 'Petri-Dish-2.svg', 'Plus-One-Increment.svg',
          'Radioactive-Circle.svg', 'Radiology-Scan-Doctor.svg', 'Satellite.svg',
          'Science-Molecule-Strucutre.svg', 'Science-Molecule.svg', 'Search-Circle.svg',
          'Settings-Slider-Desktop-Horizontal.svg', 'Share.svg', 'Shrink.svg',
          'Skull-1.svg', 'Stopwatch.svg', 'Synchronize-Arrows-Three.svg',
          'Tags-Favorite.svg', 'Time-Clock-Fire.svg', 'Time-Daily-1.svg',
          'Tool-Box.svg', 'User-Question.svg', 'User-Signal-1.svg',
          'View-Square.svg', 'Voice-Id-Approved.svg', 'Voice-Id.svg', 'Wifi-Signal-2.svg'
        ];
        
        state.availableIcons = iconNames;
        
      } catch (e) {
        console.log('Some assets not found');
      }
      render();
    }

    function parseCSV(text) {
      const lines = text.trim().split('\n');
      const headers = lines[0].split(',').map(h => h.trim());
      return lines.slice(1).map(line => {
        const values = line.split(',');
        return headers.reduce((obj, header, index) => {
          obj[header] = values[index]?.trim() || '';
          return obj;
        }, {});
      });
    }

    async function handleFileUpload(file) {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result);
        reader.readAsDataURL(file);
      });
    }

    function updateSection(sectionKey, field, value) {
      state.sections[sectionKey][field] = value;
      render();
    }

    function openModal(content) {
      state.modal = content;
      render();
    }

    function closeModal() {
      state.modal = null;
      render();
    }

    function renderHome() {
      return `
        <div class="home-view">
          <div class="home-content">
            <h1 class="home-title">Precision AQ<br/>Landing Page Builder</h1>
            <p class="home-desc">
              Create customized landing pages for your RFP responses with an intuitive interface. Export as a single, self-contained HTML file.
            </p>
            <button class="home-btn" onclick="state.view='builder'; render();">
              Start A Project
            </button>
          </div>
          <div class="home-footer">Built by Jack</div>
        </div>
      `;
    }

    function renderBuilder() {
      return `
        <div class="builder-view">
          ${renderEditorPanel()}
          ${renderPreviewPanel()}
        </div>
        ${state.modal ? renderModal() : ''}
      `;
    }

    function renderModal() {
      return `
        <div class="modal-overlay" onclick="if(event.target === this) closeModal();">
          <div class="modal-content">
            <button class="modal-close" onclick="closeModal();">Ã—</button>
            ${state.modal}
          </div>
        </div>
      `;
    }

    function renderEditorPanel() {
      return `
        <div class="editor-panel">
          <div class="editor-header">
            <h2 class="editor-title">Website Builder</h2>
            <p class="editor-subtitle">Edit your landing page sections below</p>
          </div>
          ${renderTabs()}
          ${renderActiveEditor()}
        </div>
      `;
    }

    function renderTabs() {
      const tabs = ['hero', 'pitch', 'team', 'caseStudies', 'faq', 'surprise', 'customization'];
      return `
        <div class="tabs">
          ${tabs.map(tab => `
            <button class="tab ${state.activeSection === tab ? 'active' : ''}" 
                    onclick="state.activeSection='${tab}'; render();">
              ${tab === 'customization' ? 'Customize & Export' : state.customization.sectionNames[tab]}
            </button>
          `).join('')}
        </div>
      `;
    }

    function renderActiveEditor() {
      switch(state.activeSection) {
        case 'hero': return renderHeroEditor();
        case 'pitch': return renderPitchEditor();
        case 'team': return renderTeamEditor();
        case 'caseStudies': return renderCaseStudiesEditor();
        case 'faq': return renderFaqEditor();
        case 'surprise': return renderSurpriseEditor();
        case 'customization': return renderCustomizationEditor();
        default: return '';
      }
    }

    function renderHeroEditor() {
      const section = state.sections.hero;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Hero Section</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}" 
                   onblur="updateSection('hero', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea" 
                      onblur="updateSection('hero', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" class="form-checkbox" ${section.showButton ? 'checked' : ''}
                     onchange="updateSection('hero', 'showButton', this.checked);">
              <span>Show Call-to-Action Button</span>
            </label>
          </div>
          
          ${section.showButton ? `
            <div class="form-group">
              <label class="form-label">Button Text</label>
              <input type="text" class="form-input" value="${section.buttonText}"
                     onblur="updateSection('hero', 'buttonText', this.value);">
            </div>
            
            <div class="form-group">
              <label class="form-label">Button Link URL</label>
              <input type="url" class="form-input" value="${section.buttonLink}" placeholder="https://example.com"
                     onblur="updateSection('hero', 'buttonLink', this.value);">
            </div>
          ` : ''}
          
          <div class="form-group">
            <label class="form-label">Hero Image/Video (.mp4)</label>
            <input type="file" class="form-input" accept="image/*,video/mp4"
                   onchange="handleHeroMedia(this);">
            ${section.media ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ Media uploaded</p>' : ''}
          </div>
        </div>
      `;
    }

    async function handleHeroMedia(input) {
      if (input.files[0]) {
        const file = input.files[0];
        const base64 = await handleFileUpload(file);
        state.sections.hero.media = base64;
        state.sections.hero.mediaType = file.type;
        render();
      }
    }

    function renderPitchEditor() {
      const section = state.sections.pitch;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Pitch Materials</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('pitch', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('pitch', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">Presentation Materials (PDF or PowerPoint only)</label>
            <input type="file" class="form-input" accept=".pdf,.ppt,.pptx"
                   onchange="handlePitchMedia(this);">
            ${section.media ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ File uploaded</p>' : ''}
          </div>
        </div>
      `;
    }

    async function handlePitchMedia(input) {
      if (input.files[0]) {
        const file = input.files[0];
        const base64 = await handleFileUpload(file);
        state.sections.pitch.media = base64;
        state.sections.pitch.mediaType = file.type;
        render();
      }
    }

    function renderTeamEditor() {
      const section = state.sections.team;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Team Bios</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('team', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('team', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          <div style="margin-bottom: 20px;">
            <h4 style="margin-bottom: 16px; font-size: 16px; font-weight: 600;">Team Members (${section.people.length}/10)</h4>
            ${section.people.map((person, idx) => `
              <div class="item-card">
                <div class="item-header">
                  <strong>${person.name || `Person ${idx + 1}`}</strong>
                  <button class="btn-danger" onclick="removeTeamMember(${idx});">Remove</button>
                </div>
                
                ${state.teamBiosData.length > 0 ? `
                  <div class="form-group">
                    <label class="form-label">Select Team Member from CSV</label>
                    <select class="form-select" onchange="loadTeamBio(${idx}, this.value);">
                      <option value="">-- Choose a team member --</option>
                      ${state.teamBiosData.map(bio => `
                        <option value="${bio.Name}" ${person.csvId === bio.Name ? 'selected' : ''}>
                          ${bio.Name}
                        </option>
                      `).join('')}
                    </select>
                  </div>
                ` : ''}
                
                <div class="form-group">
                  <label class="form-label">Name</label>
                  <input type="text" class="form-input" value="${person.name || ''}" placeholder="Name"
                         onblur="state.sections.team.people[${idx}].name = this.value; render();">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Title</label>
                  <input type="text" class="form-input" value="${person.title || ''}" placeholder="Title"
                         onblur="state.sections.team.people[${idx}].title = this.value; render();">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Bio</label>
                  <textarea class="form-textarea" placeholder="Bio text..."
                            onblur="state.sections.team.people[${idx}].bio = this.value; render();">${person.bio || ''}</textarea>
                </div>
                
                <div class="form-group">
                  <label class="form-label">LinkedIn URL</label>
                  <input type="url" class="form-input" value="${person.linkedin || ''}" placeholder="https://linkedin.com/in/..."
                         onblur="state.sections.team.people[${idx}].linkedin = this.value; render();">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Photo</label>
                  <input type="file" class="form-input" accept="image/*"
                         onchange="uploadTeamPhoto(${idx}, this);">
                  ${person.image ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ Photo uploaded</p>' : ''}
                </div>
              </div>
            `).join('')}
            
            ${section.people.length < 10 ? `
              <button class="btn-primary" onclick="addTeamMember();">+ Add Team Member</button>
            ` : ''}
          </div>
        </div>
      `;
    }

    function addTeamMember() {
      state.sections.team.people.push({ name: '', title: '', bio: '', image: null, linkedin: '', csvId: null });
      render();
    }

    function removeTeamMember(idx) {
      state.sections.team.people.splice(idx, 1);
      render();
    }

    async function loadTeamBio(idx, name) {
      const bio = state.teamBiosData.find(b => b.Name === name);
      if (bio) {
        const person = state.sections.team.people[idx];
        person.name = bio.Name;
        person.title = bio.Title;
        person.bio = bio.Bio;
        person.linkedin = bio.LinkedIn;
        person.csvId = bio.Name;
        
        if (bio.Image) {
          try {
            const imgResponse = await fetch(`Assets/Bios/bio-images/${bio.Image}`);
            if (imgResponse.ok) {
              const imgBlob = await imgResponse.blob();
              person.image = await new Promise((resolve) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.readAsDataURL(imgBlob);
              });
            }
          } catch (e) {
            console.log('Image not found');
          }
        }
        render();
      }
    }

    async function uploadTeamPhoto(idx, input) {
      if (input.files[0]) {
        const base64 = await handleFileUpload(input.files[0]);
        state.sections.team.people[idx].image = base64;
        state.sections.team.people[idx].csvId = null; 
        render();
      }
    }

    function renderCaseStudiesEditor() {
      const section = state.sections.caseStudies;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Case Studies</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('caseStudies', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('caseStudies', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          ${section.studies.map((study, idx) => `
            <div class="item-card">
              <div class="item-header">
                <strong>Case Study ${idx + 1}</strong>
                <button class="btn-danger" onclick="removeCaseStudy(${idx});">Remove</button>
              </div>
              
              <div class="form-group">
                <label class="form-label">Heading</label>
                <input type="text" class="form-input" value="${study.heading || ''}" placeholder="Heading"
                       onblur="state.sections.caseStudies.studies[${idx}].heading = this.value; render();">
              </div>
              
              <div class="form-group">
                <label class="form-label">Description</label>
                <textarea class="form-textarea" placeholder="Description"
                          onblur="state.sections.caseStudies.studies[${idx}].subheading = this.value; render();">${study.subheading || ''}</textarea>
              </div>
              
              <div class="form-group">
                <label class="form-label">Case Study File (PDF, Image, Video)</label>
                <input type="file" class="form-input" accept=".pdf,image/*,video/*"
                       onchange="uploadCaseFile(${idx}, this);">
                ${study.file ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ File uploaded</p>' : ''}
              </div>
              
              <div class="form-group">
                <label class="form-label">Icon</label>
                <button class="btn-primary" onclick="showIconPicker(${idx});" style="width: auto;">Choose Icon</button>
                ${study.icon ? `
                  <div style="margin-top: 10px; display: flex; align-items: center; gap: 10px;">
                    <img src="${study.icon}" style="width: 40px; height: 40px; object-fit: contain;">
                    <span style="font-size: 12px; color: #45b000;">âœ“ Icon selected</span>
                  </div>
                ` : ''}
              </div>
            </div>
          `).join('')}
          
          ${section.studies.length < 6 ? `
            <button class="btn-primary" onclick="addCaseStudy();">Add Case Study</button>
          ` : ''}
        </div>
      `;
    }

    function addCaseStudy() {
      state.sections.caseStudies.studies.push({ 
        id: Date.now(), 
        heading: '', 
        subheading: '', 
        icon: '',
        file: null,
        fileType: null 
      });
      render();
    }

    function removeCaseStudy(idx) {
      state.sections.caseStudies.studies.splice(idx, 1);
      render();
    }

    async function uploadCaseFile(idx, input) {
      if (input.files[0]) {
        const file = input.files[0];
        const base64 = await handleFileUpload(file);
        state.sections.caseStudies.studies[idx].file = base64;
        state.sections.caseStudies.studies[idx].fileType = file.type;
        render();
      }
    }

    function showIconPicker(idx) {
      const iconGrid = state.availableIcons.map((iconName) => `
        <div class="icon-option" onclick="selectIcon(${idx}, 'Assets/Icons/${iconName}');">
          <img src="Assets/Icons/${iconName}" alt="${iconName}">
          <div class="icon-name">${iconName.replace('.svg', '').replace(/-/g, ' ')}</div>
        </div>
      `).join('');
      
      openModal(`
        <h3 style="margin-bottom: 20px; text-align: center;">Select an Icon</h3>
        <div class="icon-picker">
          ${iconGrid}
        </div>
      `);
    }

    function selectIcon(idx, iconPath) {
      state.sections.caseStudies.studies[idx].icon = iconPath;
      closeModal();
      render();
    }

    function renderFaqEditor() {
      const section = state.sections.faq;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">FAQ</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('faq', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('faq', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          ${state.faqFiles.length > 0 ? `
            <div class="form-group">
              <label class="form-label">Load Pre-built FAQ Set</label>
              <select class="form-select" onchange="loadFAQSet(this.value);">
                <option value="">-- Choose an FAQ set --</option>
                ${state.faqFiles.map(file => `
                  <option value="${file.name}">${file.name.replace('.json', '').replace(/-/g, ' ')}</option>
                `).join('')}
              </select>
              <p style="font-size: 12px; color: #666; margin-top: 6px;">Select a pre-built FAQ to populate questions below</p>
            </div>
          ` : ''}
          
          ${section.questions.map((q, idx) => `
            <div class="item-card">
              <div class="item-header">
                <strong>Question ${idx + 1}</strong>
                <button class="btn-danger" onclick="removeFAQ(${idx});">Remove</button>
              </div>
              
              <div class="form-group">
                <label class="form-label">Question</label>
                <input type="text" class="form-input" value="${q.question || ''}" placeholder="Question"
                       onblur="state.sections.faq.questions[${idx}].question = this.value; render();">
              </div>
              
              <div class="form-group">
                <label class="form-label">Answer</label>
                <textarea class="form-textarea" placeholder="Answer"
                          onblur="state.sections.faq.questions[${idx}].answer = this.value; render();">${q.answer || ''}</textarea>
              </div>
            </div>
          `).join('')}
          
          ${section.questions.length < 10 ? `
            <button class="btn-primary" onclick="addFAQ();">Add FAQ Question</button>
          ` : ''}
        </div>
      `;
    }

    function loadFAQSet(fileName) {
      if (!fileName) return;
      const faqFile = state.faqFiles.find(f => f.name === fileName);
      if (faqFile && faqFile.data) {
        let questions = [];
        if (Array.isArray(faqFile.data)) {
            questions = faqFile.data.map(q => ({ question: q.question, answer: q.answer }));
        } else if (faqFile.data.questions) {
          questions = faqFile.data.questions;
        } else if (faqFile.data.faqVersion && faqFile.data.faqVersion.questions) {
          questions = faqFile.data.faqVersion.questions;
        } else {
          const values = Object.values(faqFile.data);
          for (const val of values) {
            if (val && Array.isArray(val.questions)) {
              questions = val.questions;
              break;
            }
          }
        }
        
        state.sections.faq.questions = questions.map(q => ({
          question: q.question || '',
          answer: q.answer || ''
        }));
        render();
      }
    }

    function addFAQ() {
      state.sections.faq.questions.push({ question: '', answer: '' });
      render();
    }

    function removeFAQ(idx) {
      state.sections.faq.questions.splice(idx, 1);
      render();
    }

    function renderSurpriseEditor() {
      const section = state.sections.surprise;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Surprise & Delight</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('surprise', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('surprise', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">Fulfillment Email</label>
            <input type="email" class="form-input" value="${section.email}" placeholder="fulfillment@precisionaq.com"
                   onblur="updateSection('surprise', 'email', this.value);">
            <p style="font-size: 12px; color: #666; margin-top: 6px;">Requests will be sent to this email address</p>
          </div>
          
          <div class="form-group">
            <label class="form-label">Feature Image (Default: coffee.png)</label>
            <input type="file" class="form-input" accept="image/*"
                   onchange="uploadSurpriseImage(this);">
            ${section.image ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ Image uploaded</p>' : ''}
          </div>
        </div>
      `;
    }

    async function uploadSurpriseImage(input) {
      if (input.files[0]) {
        const base64 = await handleFileUpload(input.files[0]);
        state.sections.surprise.image = base64;
        render();
      }
    }

    function renderCustomizationEditor() {
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Customize & Export</h3>
          <p style="margin-bottom: 20px; color: #666; font-size: 14px;">Control which sections appear on your landing page and their order.</p>
          
          <table class="custom-table">
            <thead>
              <tr>
                <th>Section Name</th>
                <th style="text-align: center;">Visible</th>
                <th style="text-align: center;">Order</th>
              </tr>
            </thead>
            <tbody>
              ${state.customization.sectionOrder.map((key, idx) => `
                <tr>
                  <td>
                    <input type="text" class="form-input" value="${state.customization.sectionNames[key]}"
                           onblur="state.customization.sectionNames['${key}'] = this.value; render();">
                  </td>
                  <td style="text-align: center;">
                    <input type="checkbox" class="form-checkbox" 
                           ${state.customization.sectionVisibility[key] ? 'checked' : ''}
                           onchange="state.customization.sectionVisibility['${key}'] = this.checked; render();">
                  </td>
                  <td style="text-align: center;">
                    <button ${idx === 0 ? 'disabled' : ''} 
                            style="margin: 0 4px; padding: 6px 10px; cursor: ${idx === 0 ? 'not-allowed' : 'pointer'}; border: 1px solid #ddd; background: ${idx === 0 ? '#f5f5f5' : 'white'}; border-radius: 4px;"
                            onclick="moveSection(${idx}, -1);">â–²</button>
                    <button ${idx === state.customization.sectionOrder.length - 1 ? 'disabled' : ''}
                            style="margin: 0 4px; padding: 6px 10px; cursor: ${idx === state.customization.sectionOrder.length - 1 ? 'not-allowed' : 'pointer'}; border: 1px solid #ddd; background: ${idx === state.customization.sectionOrder.length - 1 ? '#f5f5f5' : 'white'}; border-radius: 4px;"
                            onclick="moveSection(${idx}, 1);">â–¼</button>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
          
          <button class="btn-export" onclick="exportWebsite();">ðŸ“¥ Export Landing Page</button>
          <p style="margin-top: 16px; font-size: 13px; color: #666; text-align: center;">
            Downloads a single, self-contained HTML file
          </p>
        </div>
      `;
    }

    function moveSection(idx, direction) {
      const newIdx = idx + direction;
      if (newIdx >= 0 && newIdx < state.customization.sectionOrder.length) {
        [state.customization.sectionOrder[idx], state.customization.sectionOrder[newIdx]] = 
        [state.customization.sectionOrder[newIdx], state.customization.sectionOrder[idx]];
        render();
      }
    }

    function renderPreviewPanel() {
      const visibleSections = state.customization.sectionOrder.filter(
        key => state.customization.sectionVisibility[key]
      );
      
      return `
        <div class="preview-panel">
          <div class="preview-header">
            <div class="nav">
              <img src="${state.logoBase64}" alt="Precision AQ" class="logo">
              <div class="menu">
                ${visibleSections.map(key => `
                  <a href="#${key}" onclick="event.preventDefault(); document.getElementById('${key}').scrollIntoView({behavior: 'smooth'});">
                    ${state.customization.sectionNames[key]}
                  </a>
                `).join('')}
              </div>
            </div>
          </div>
          
          ${visibleSections.map(key => renderPreviewSection(key)).join('')}
        </div>
      `;
    }

    function renderPreviewSection(key) {
      const section = state.sections[key];
      
      switch(key) {
        case 'hero':
          return `
            <div id="hero" class="section preview-section hero">
              <h1>${section.headline}</h1>
              <p>${section.subheading}</p>
              ${section.showButton ? `
                <a href="${section.buttonLink || '#'}" class="preview-btn btn" target="_blank" rel="noopener">
                  ${section.buttonText}
                </a>
              ` : ''}
              ${section.media ? 
                (section.mediaType?.startsWith('video') ? 
                  `<video controls style="max-width: 90%; margin-top: 40px;"><source src="${section.media}" type="${section.mediaType}"></video>` :
                  `<div style="margin-top: 40px;"><img src="${section.media}" alt="Hero" style="max-width: 90%; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.3);"></div>`
                ) : ''
              }
            </div>
          `;
          
        case 'pitch':
          return `
            <div id="pitch" class="section preview-section">
              <h2>${section.headline}</h2>
              <p class="subheading">${section.subheading}</p>
              ${section.media ? `
                <div style="text-align: center; margin-top: 30px;">
                  <button class="btn-primary" onclick="openModal('pitch');" style="cursor: pointer; border: none; font-family: inherit;">
                    ðŸ“„ View Presentation
                  </button>
                </div>
                <div id="modal-pitch" class="modal-overlay" onclick="if(event.target === this) closeModal('pitch');">
                  <div class="modal-content">
                    <button class="modal-close" onclick="closeModal('pitch');">Ã—</button>
                    <embed src="${section.media}" type="${section.mediaType || 'application/pdf'}" style="width: 100%; height: 85vh;" />
                  </div>
                </div>
              ` : ''}
            </div>
          `;
          
        case 'team':
          if (section.people.length === 0) return '';
          return `
            <div id="team" class="section preview-section" style="background: #f8f9fa;">
              <h2>${section.headline}</h2>
              <p class="subheading">${section.subheading}</p>
              <div class="team-grid">
                ${section.people.map((person, idx) => `
                  <div class="team-card" id="team-card-${idx}" onclick="this.classList.toggle('expanded');">
                    <div class="team-avatar">
                      ${person.image ? `<img src="${person.image}" alt="${person.name}">` : ''}
                    </div>
                    <h3>${person.name}</h3>
                    <p>${person.title}</p>
                    ${person.linkedin ? `<a href="${person.linkedin}" target="_blank" onclick="event.stopPropagation();" style="color: #cb009f; font-size: 14px; text-decoration: none; margin-top: 10px; display: inline-block;">LinkedIn â†’</a>` : ''}
                    ${person.bio ? `
                      <div class="team-bio">
                        <strong style="display: block; margin-bottom: 8px; color: #333;">About:</strong>
                        ${person.bio}
                      </div>
                    ` : ''}
                  </div>
                `).join('')}
              </div>
              <p style="text-align: center; margin-top: 20px; font-size: 14px; color: #666; font-style: italic;">Click on a team member to read their bio</p>
            </div>
          `;
          
        case 'caseStudies':
          if (section.studies.length === 0 || !section.studies.some(s => s.heading)) return '';
          return `
            <div id="caseStudies" class="section preview-section">
              <h2>${section.headline}</h2>
              <p class="subheading">${section.subheading}</p>
              <div class="case-studies-grid">
                ${section.studies.filter(s => s.heading).map((study, idx) => `
                  <div class="case-study-card" ${study.file ? `onclick="openModal('case-${idx}');"` : ''}>
                    ${study.icon ? `<img src="${study.icon}" alt="Icon">` : ''}
                    <h3>${study.heading}</h3>
                    <p>${study.subheading}</p>
                  </div>
                  ${study.file ? `
                    <div id="modal-case-${idx}" class="modal-overlay" onclick="if(event.target === this) closeModal('case-${idx}');">
                      <div class="modal-content">
                        <button class="modal-close" onclick="closeModal('case-${idx}');">Ã—</button>
                        <embed src="${study.file}" type="${study.fileType || 'application/pdf'}" style="width: 100%; height: 85vh;" />
                      </div>
                    </div>
                  ` : ''}
                `).join('')}
              </div>
            </div>
          `;
          
        case 'faq':
          if (section.questions.length === 0) return '';
          return `
            <div id="faq" class="section preview-section" style="background: #f8f9fa;">
              <h2>${section.headline}</h2>
              <p class="subheading">${section.subheading}</p>
              ${section.questions.map((q, idx) => `
                <div class="faq-item">
                  <div class="faq-question" onclick="toggleFAQ(${idx});">
                    ${q.question}
                    <span id="faq-icon-${idx}">â–¼</span>
                  </div>
                  <div class="faq-answer" id="faq-answer-${idx}">${q.answer}</div>
                </div>
              `).join('')}
            </div>
          `;
          
        case 'surprise':
          return `
            <div id="surprise" class="section preview-section">
              <div class="surprise-container">
                <div class="surprise-image">
                  ${section.image ? `<img src="${section.image}" alt="Coffee">` : ''}
                </div>
                <div class="surprise-content">
                  <h2>${section.headline}</h2>
                  <p>${section.subheading}</p>
                  <div class="surprise-form">
                    <div class="surprise-form-row">
                      <input type="text" placeholder="First Name" id="surprise-first">
                      <input type="text" placeholder="Last Name" id="surprise-last">
                    </div>
                    <input type="email" placeholder="Email Address" id="surprise-email">
                    <button onclick="submitSurpriseForm();">Give Me Coffee</button>
                  </div>
                </div>
              </div>
            </div>
          `;
          
        default:
          return '';
      }
    }

    function submitSurpriseForm() {
      const firstName = document.getElementById('surprise-first').value;
      const lastName = document.getElementById('surprise-last').value;
      const email = document.getElementById('surprise-email').value;
      
      if (firstName && lastName && email) {
        const mailtoLink = 'mailto:${state.sections.surprise.email}?subject=Coffee Request&body=First Name: ' + encodeURIComponent(firstName) + '%0D%0ALast Name: ' + encodeURIComponent(lastName) + '%0D%0AEmail: ' + encodeURIComponent(email);
        window.location.href = mailtoLink;
      } else {
        alert('Please fill in all fields');
      }
    }

    function exportWebsite() {
      const visibleSections = state.customization.sectionOrder.filter(
        key => state.customization.sectionVisibility[key]
      );
      
      const exportHTML = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${state.sections.hero.headline} - Precision AQ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Proxima Nova', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      color: #0f1822;
    }
    
    .header {
      position: sticky;
      top: 0;
      background: white;
      padding: 20px 40px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 100;
    }
    .nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }
    .logo {
      height: 40px;
    }
    .menu {
      display: flex;
      gap: 25px;
      flex-wrap: wrap;
    }
    .menu a {
      color: #0f1822;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      transition: color 0.3s;
    }
    .menu a:hover {
      color: #cb009f;
    }
    
    .section {
      padding: 80px 40px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .hero {
      background: linear-gradient(135deg, #cb009f 0%, #850064 100%);
      color: white;
      text-align: center;
      max-width: 100%;
    }
    .hero h1 {
      font-size: 48px;
      margin-bottom: 20px;
      font-weight: bold;
      line-height: 1.2;
    }
    .hero p {
      font-size: 20px;
      margin-bottom: 30px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.6;
    }
    .btn {
      background: white;
      color: #cb009f;
      padding: 14px 32px;
      border-radius: 8px;
      text-decoration: none;
      display: inline-block;
      font-weight: bold;
      font-size: 16px;
      transition: all 0.3s;
      cursor: pointer;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .section h2 {
      font-size: 36px;
      color: #cb009f;
      margin-bottom: 15px;
      font-weight: bold;
    }
    .section .subheading {
      font-size: 18px;
      color: #666;
      margin-bottom: 40px;
      line-height: 1.6;
    }
    
    .team-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 30px;
    }
    .team-card {
      text-align: center;
      padding: 24px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      cursor: pointer;
      transition: all 0.3s;
    }
    .team-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .team-avatar {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: #dcdde1;
      margin: 0 auto 15px;
      overflow: hidden;
    }
    .team-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .team-card h3 {
      color: #cb009f;
      margin-bottom: 5px;
      font-size: 18px;
      font-weight: 600;
    }
    .team-card p {
      color: #666;
      font-size: 14px;
    }
    .team-bio {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #e0e0e0;
      text-align: left;
      font-size: 13px;
      line-height: 1.5;
      color: #666;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .team-card.expanded .team-bio {
      max-height: 500px;
    }
    
    .case-studies-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
    }
    .case-study-card {
      padding: 30px;
      background: #f8f9fa;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      cursor: pointer;
      transition: all 0.3s;
    }
    .case-study-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .case-study-card img {
      width: 60px;
      height: 60px;
      margin-bottom: 15px;
      object-fit: contain;
    }
    .case-study-card h3 {
      color: #cb009f;
      margin-bottom: 12px;
      font-size: 20px;
      font-weight: 600;
    }
    .case-study-card p {
      color: #666;
      font-size: 15px;
      line-height: 1.5;
    }
    
    .faq-item {
      margin-bottom: 15px;
      border: 1px solid #dcdde1;
      border-radius: 8px;
      overflow: hidden;
      background: white;
    }
    .faq-question {
      background: #f8f9fa;
      padding: 20px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 15px;
      color: #333;
      transition: background 0.2s;
    }
    .faq-question:hover {
      background: #e9ecef;
    }
    .faq-answer {
      padding: 20px;
      font-size: 14px;
      color: #666;
      line-height: 1.6;
      display: none;
    }
    .faq-answer.active {
      display: block;
    }
    
    .surprise-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 60px;
      align-items: center;
      max-width: 1000px;
      margin: 0 auto;
    }
    .surprise-image {
      text-align: center;
    }
    .surprise-image img {
      max-width: 100%;
      max-height: 500px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .surprise-content {
      text-align: left;
    }
    .surprise-content h2 {
      font-size: 36px;
      color: #0f1822;
      margin-bottom: 20px;
      text-align: left;
    }
    .surprise-content p {
      font-size: 16px;
      color: #666;
      line-height: 1.6;
      margin-bottom: 30px;
    }
    .surprise-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .surprise-form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    .surprise-form input {
      width: 100%;
      padding: 14px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
    }
    .surprise-form button {
      padding: 16px;
      background: #cb009f;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }
    .surprise-form button:hover {
      background: #850064;
    }
    
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }
    .modal-overlay.active {
      display: flex;
    }
    .modal-content {
      background: white;
      border-radius: 12px;
      max-width: 90%;
      max-height: 90vh;
      overflow: auto;
      position: relative;
      padding: 40px 20px 20px;
    }
    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      font-size: 20px;
      cursor: pointer;
      font-weight: bold;
      z-index: 1;
    }
    .modal-close:hover {
      background: #c82333;
    }
    
    video {
      max-width: 100%;
      border-radius: 12px;
      margin-top: 30px;
    }
    
    @media (max-width: 768px) {
      .hero h1 { font-size: 32px; }
      .hero p { font-size: 16px; }
      .section h2 { font-size: 28px; }
      .surprise-container {
        grid-template-columns: 1fr;
        gap: 30px;
      }
      .surprise-form-row {
        grid-template-columns: 1fr;
      }
      .menu {
        gap: 15px;
      }
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // State management
    const state = {
      view: 'home',
      activeSection: 'hero',
      sections: {
        hero: {
          headline: "Thanks for having us!",
          subheading: "It was an honor and a privilege to be able to be considered for your RFP and the time to share our thinking with you. In case you forgot anything we shared, please have a look around.",
          showButton: true,
          buttonText: "Be in Touch",
          buttonLink: "",
          media: null,
          mediaType: null
        },
        pitch: {
          headline: "What we shared with you",
          subheading: "In case you missed it, here's a refresher of what we shared with you in our presentation",
          media: null,
          mediaType: null
        },
        team: {
          headline: "Meet Your Team",
          subheading: "The folks on your side throughout the work",
          people: []
        },
        caseStudies: {
          headline: "Show Your Work",
          subheading: "We have loads of experience and here are some relevant case studies from our recent work",
          studies: []
        },
        faq: {
          headline: "Learn more about Precision AQ",
          subheading: "additional background on Precision AQ and other things",
          questions: []
        },
        surprise: {
          headline: "Know what's keeping you up at night",
          subheading: "With our partnership, you can sleep easy knowing we have your back. Now, the only thing keeping you up will be the coffee!",
          image: null,
          email: ""
        }
      },
      customization: {
        sectionOrder: ['hero', 'pitch', 'team', 'caseStudies', 'faq', 'surprise'],
        sectionVisibility: {
          hero: true,
          pitch: true,
          team: true,
          caseStudies: true,
          faq: true,
          surprise: true
        },
        sectionNames: {
          hero: 'Hero Header',
          pitch: 'Pitch Materials',
          team: 'Team Bios',
          caseStudies: 'Case Studies',
          faq: 'FAQ',
          surprise: 'Surprise & Delight'
        }
      },
      logoBase64: '',
      teamBiosData: [],
      faqFiles: [],
      availableIcons: [],
      modal: null 
    };

    async function loadAssets() {
      try {
        const logoResponse = await fetch('Assets/PAQ-logo.png');
        if (logoResponse.ok) {
          const logoBlob = await logoResponse.blob();
          state.logoBase64 = await new Promise((resolve) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result);
            reader.readAsDataURL(logoBlob);
          });
        }
        
        const coffeeResponse = await fetch('Assets/coffee.png');
        if (coffeeResponse.ok) {
          const coffeeBlob = await coffeeResponse.blob();
          state.sections.surprise.image = await new Promise((resolve) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result);
            reader.readAsDataURL(coffeeBlob);
          });
        }
        
        const csvResponse = await fetch('Assets/Bios/team-bios.csv');
        if (csvResponse.ok) {
          const csvText = await csvResponse.text();
          state.teamBiosData = parseCSV(csvText);
        }
        
        try {
          const faqFiles = ['peanuts-faq.json', 'precision-aq-faq.json'];
          for (const file of faqFiles) {
            try {
              const response = await fetch(`Assets/FAQs/${file}`);
              if (response.ok) {
                state.faqFiles.push({ name: file, data: await response.json() });
              }
            } catch (e) {}
          }
        } catch (e) {}
        
        const iconNames = [
          'Add-Circle-Bold.svg', 'Alarm-Bell-Ring.svg', 'Alert-Bell-Notification-2.svg', 
          'Alert-Octagon-1.svg', 'Ampersand.svg', 'Arrange-Letter.svg', 
          'Arrange-List-Descending.svg', 'Arrange-Number-Descending.svg', 'Attachment.svg',
          'Bill-Cross.svg', 'Bin-1.svg', 'Binocular.svg', 'Blood-Bag-Cross.svg',
          'Book-Close-Bookmark-1.svg', 'Book-Open-Bookmark.svg', 'Bookmark-Cancel-Delete.svg',
          'Bookmarks-Document.svg', 'Branch-Line-5.svg', 'Brightness.svg',
          'Button-Fast-Forward-1.svg', 'Button-Loop.svg', 'Button-Play.svg',
          'Button-Stop.svg', 'Button-Zigzag-1.svg', 'Calendar-3.svg',
          'Calendar-Edit-1.svg', 'Cell-Border-Frame.svg', 'Check-Badge.svg',
          'Check-Double.svg', 'Check-Square.svg', 'Checklist.svg',
          'Checkup-Chart.svg', 'Coding-Apps-Website-Web-Form-Text-Area-1.svg',
          'Cog-Hand-Give-1.svg', 'Cog-Search-1.svg', 'Cog.svg',
          'Command-Button-Keyboard.svg', 'Cursor-Hand-2.svg', 'Cursor-Speed-2.svg',
          'Cursor-Target-1.svg', 'Cursor.svg', 'Delete-2.svg', 'Delete.svg',
          'Diagnostic-Desktop.svg', 'Dial-Finger-1.svg', 'Dial-Pad.svg',
          'Direction-Button-2.svg', 'Direction-Button-3.svg', 'Division-Math-Symbol-Circle.svg',
          'Duplicate.svg', 'Equal-Math-Symbol-Circle.svg', 'Expand-2.svg',
          'Expand-Full.svg', 'Face-Id-1.svg', 'Filter-1.svg',
          'Filter-Sort-Lines-Descending.svg', 'Gauge-Dashboard.svg', 'Hand-Drag.svg',
          'Hospital-Building-Pin.svg', 'Hospital-Sign.svg', 'Insurance-Hand.svg',
          'Insurance-Head.svg', 'Iris-Scan-1.svg', 'Lab-Tube-Experiment.svg',
          'Lab-Tube.svg', 'Lock-Shield.svg', 'Lock-Unlock-4.svg', 'Login-Key.svg',
          'Medical-App-Laptop-1.svg', 'Medical-Specialty-Knee-1.svg', 'Megaphone.svg',
          'Multiple-Users-1.svg', 'Multiple-Users-Network.svg', 'Paper-Write.svg',
          'Pen-Write.svg', 'Pencil-1.svg', 'Petri-Dish-2.svg', 'Plus-One-Increment.svg',
          'Radioactive-Circle.svg', 'Radiology-Scan-Doctor.svg', 'Satellite.svg',
          'Science-Molecule-Strucutre.svg', 'Science-Molecule.svg', 'Search-Circle.svg',
          'Settings-Slider-Desktop-Horizontal.svg', 'Share.svg', 'Shrink.svg',
          'Skull-1.svg', 'Stopwatch.svg', 'Synchronize-Arrows-Three.svg',
          'Tags-Favorite.svg', 'Time-Clock-Fire.svg', 'Time-Daily-1.svg',
          'Tool-Box.svg', 'User-Question.svg', 'User-Signal-1.svg',
          'View-Square.svg', 'Voice-Id-Approved.svg', 'Voice-Id.svg', 'Wifi-Signal-2.svg'
        ];
        
        state.availableIcons = iconNames;
        
      } catch (e) {
        console.log('Some assets not found');
      }
      render();
    }

    function parseCSV(text) {
      const lines = text.trim().split('\n');
      const headers = lines[0].split(',').map(h => h.trim());
      return lines.slice(1).map(line => {
        const values = line.split(',');
        return headers.reduce((obj, header, index) => {
          obj[header] = values[index]?.trim() || '';
          return obj;
        }, {});
      });
    }

    async function handleFileUpload(file) {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result);
        reader.readAsDataURL(file);
      });
    }

    function updateSection(sectionKey, field, value) {
      state.sections[sectionKey][field] = value;
      render();
    }

    function openModal(content) {
      state.modal = content;
      render();
    }

    function closeModal() {
      state.modal = null;
      render();
    }

    function renderHome() {
      return `
        <div class="home-view">
          <div class="home-content">
            <h1 class="home-title">Precision AQ<br/>Landing Page Builder</h1>
            <p class="home-desc">
              Create customized landing pages for your RFP responses with an intuitive interface. Export as a single, self-contained HTML file.
            </p>
            <button class="home-btn" onclick="state.view='builder'; render();">
              Start A Project
            </button>
          </div>
          <div class="home-footer">Built by Jack</div>
        </div>
      `;
    }

    function renderBuilder() {
      return `
        <div class="builder-view">
          ${renderEditorPanel()}
          ${renderPreviewPanel()}
        </div>
        ${state.modal ? renderModal() : ''}
      `;
    }

    function renderModal() {
      return `
        <div class="modal-overlay" onclick="if(event.target === this) closeModal();">
          <div class="modal-content">
            <button class="modal-close" onclick="closeModal();">Ã—</button>
            ${state.modal}
          </div>
        </div>
      `;
    }

    function renderEditorPanel() {
      return `
        <div class="editor-panel">
          <div class="editor-header">
            <h2 class="editor-title">Website Builder</h2>
            <p class="editor-subtitle">Edit your landing page sections below</p>
          </div>
          ${renderTabs()}
          ${renderActiveEditor()}
        </div>
      `;
    }

    function renderTabs() {
      const tabs = ['hero', 'pitch', 'team', 'caseStudies', 'faq', 'surprise', 'customization'];
      return `
        <div class="tabs">
          ${tabs.map(tab => `
            <button class="tab ${state.activeSection === tab ? 'active' : ''}" 
                    onclick="state.activeSection='${tab}'; render();">
              ${tab === 'customization' ? 'Customize & Export' : state.customization.sectionNames[tab]}
            </button>
          `).join('')}
        </div>
      `;
    }

    function renderActiveEditor() {
      switch(state.activeSection) {
        case 'hero': return renderHeroEditor();
        case 'pitch': return renderPitchEditor();
        case 'team': return renderTeamEditor();
        case 'caseStudies': return renderCaseStudiesEditor();
        case 'faq': return renderFaqEditor();
        case 'surprise': return renderSurpriseEditor();
        case 'customization': return renderCustomizationEditor();
        default: return '';
      }
    }

    function renderHeroEditor() {
      const section = state.sections.hero;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Hero Section</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}" 
                   onblur="updateSection('hero', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea" 
                      onblur="updateSection('hero', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" class="form-checkbox" ${section.showButton ? 'checked' : ''}
                     onchange="updateSection('hero', 'showButton', this.checked);">
              <span>Show Call-to-Action Button</span>
            </label>
          </div>
          
          ${section.showButton ? `
            <div class="form-group">
              <label class="form-label">Button Text</label>
              <input type="text" class="form-input" value="${section.buttonText}"
                     onblur="updateSection('hero', 'buttonText', this.value);">
            </div>
            
            <div class="form-group">
              <label class="form-label">Button Link URL</label>
              <input type="url" class="form-input" value="${section.buttonLink}" placeholder="https://example.com"
                     onblur="updateSection('hero', 'buttonLink', this.value);">
            </div>
          ` : ''}
          
          <div class="form-group">
            <label class="form-label">Hero Image/Video (.mp4)</label>
            <input type="file" class="form-input" accept="image/*,video/mp4"
                   onchange="handleHeroMedia(this);">
            ${section.media ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ Media uploaded</p>' : ''}
          </div>
        </div>
      `;
    }

    async function handleHeroMedia(input) {
      if (input.files[0]) {
        const file = input.files[0];
        const base64 = await handleFileUpload(file);
        state.sections.hero.media = base64;
        state.sections.hero.mediaType = file.type;
        render();
      }
    }

    function renderPitchEditor() {
      const section = state.sections.pitch;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Pitch Materials</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('pitch', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('pitch', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">Presentation Materials (PDF or PowerPoint only)</label>
            <input type="file" class="form-input" accept=".pdf,.ppt,.pptx"
                   onchange="handlePitchMedia(this);">
            ${section.media ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ File uploaded</p>' : ''}
          </div>
        </div>
      `;
    }

    async function handlePitchMedia(input) {
      if (input.files[0]) {
        const file = input.files[0];
        const base64 = await handleFileUpload(file);
        state.sections.pitch.media = base64;
        state.sections.pitch.mediaType = file.type;
        render();
      }
    }

    function renderTeamEditor() {
      const section = state.sections.team;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Team Bios</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('team', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('team', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          <div style="margin-bottom: 20px;">
            <h4 style="margin-bottom: 16px; font-size: 16px; font-weight: 600;">Team Members (${section.people.length}/10)</h4>
            ${section.people.map((person, idx) => `
              <div class="item-card">
                <div class="item-header">
                  <strong>${person.name || `Person ${idx + 1}`}</strong>
                  <button class="btn-danger" onclick="removeTeamMember(${idx});">Remove</button>
                </div>
                
                ${state.teamBiosData.length > 0 ? `
                  <div class="form-group">
                    <label class="form-label">Select Team Member from CSV</label>
                    <select class="form-select" onchange="loadTeamBio(${idx}, this.value);">
                      <option value="">-- Choose a team member --</option>
                      ${state.teamBiosData.map(bio => `
                        <option value="${bio.Name}" ${person.csvId === bio.Name ? 'selected' : ''}>
                          ${bio.Name}
                        </option>
                      `).join('')}
                    </select>
                  </div>
                ` : ''}
                
                <div class="form-group">
                  <label class="form-label">Name</label>
                  <input type="text" class="form-input" value="${person.name || ''}" placeholder="Name"
                         onblur="state.sections.team.people[${idx}].name = this.value; render();">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Title</label>
                  <input type="text" class="form-input" value="${person.title || ''}" placeholder="Title"
                         onblur="state.sections.team.people[${idx}].title = this.value; render();">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Bio</label>
                  <textarea class="form-textarea" placeholder="Bio text..."
                            onblur="state.sections.team.people[${idx}].bio = this.value; render();">${person.bio || ''}</textarea>
                </div>
                
                <div class="form-group">
                  <label class="form-label">LinkedIn URL</label>
                  <input type="url" class="form-input" value="${person.linkedin || ''}" placeholder="https://linkedin.com/in/..."
                         onblur="state.sections.team.people[${idx}].linkedin = this.value; render();">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Photo</label>
                  <input type="file" class="form-input" accept="image/*"
                         onchange="uploadTeamPhoto(${idx}, this);">
                  ${person.image ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ Photo uploaded</p>' : ''}
                </div>
              </div>
            `).join('')}
            
            ${section.people.length < 10 ? `
              <button class="btn-primary" onclick="addTeamMember();">+ Add Team Member</button>
            ` : ''}
          </div>
        </div>
      `;
    }

    function addTeamMember() {
      state.sections.team.people.push({ name: '', title: '', bio: '', image: null, linkedin: '', csvId: null });
      render();
    }

    function removeTeamMember(idx) {
      state.sections.team.people.splice(idx, 1);
      render();
    }

    async function loadTeamBio(idx, name) {
      const bio = state.teamBiosData.find(b => b.Name === name);
      if (bio) {
        const person = state.sections.team.people[idx];
        person.name = bio.Name;
        person.title = bio.Title;
        person.bio = bio.Bio;
        person.linkedin = bio.LinkedIn;
        person.csvId = bio.Name;
        
        if (bio.Image) {
          try {
            const imgResponse = await fetch(`Assets/Bios/bio-images/${bio.Image}`);
            if (imgResponse.ok) {
              const imgBlob = await imgResponse.blob();
              person.image = await new Promise((resolve) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.readAsDataURL(imgBlob);
              });
            }
          } catch (e) {
            console.log('Image not found');
          }
        }
        render();
      }
    }

    async function uploadTeamPhoto(idx, input) {
      if (input.files[0]) {
        const base64 = await handleFileUpload(input.files[0]);
        state.sections.team.people[idx].image = base64;
        state.sections.team.people[idx].csvId = null; 
        render();
      }
    }

    function renderCaseStudiesEditor() {
      const section = state.sections.caseStudies;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Case Studies</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('caseStudies', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('caseStudies', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          ${section.studies.map((study, idx) => `
            <div class="item-card">
              <div class="item-header">
                <strong>Case Study ${idx + 1}</strong>
                <button class="btn-danger" onclick="removeCaseStudy(${idx});">Remove</button>
              </div>
              
              <div class="form-group">
                <label class="form-label">Heading</label>
                <input type="text" class="form-input" value="${study.heading || ''}" placeholder="Heading"
                       onblur="state.sections.caseStudies.studies[${idx}].heading = this.value; render();">
              </div>
              
              <div class="form-group">
                <label class="form-label">Description</label>
                <textarea class="form-textarea" placeholder="Description"
                          onblur="state.sections.caseStudies.studies[${idx}].subheading = this.value; render();">${study.subheading || ''}</textarea>
              </div>
              
              <div class="form-group">
                <label class="form-label">Case Study File (PDF, Image, Video)</label>
                <input type="file" class="form-input" accept=".pdf,image/*,video/*"
                       onchange="uploadCaseFile(${idx}, this);">
                ${study.file ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ File uploaded</p>' : ''}
              </div>
              
              <div class="form-group">
                <label class="form-label">Icon</label>
                <button class="btn-primary" onclick="showIconPicker(${idx});" style="width: auto;">Choose Icon</button>
                ${study.icon ? `
                  <div style="margin-top: 10px; display: flex; align-items: center; gap: 10px;">
                    <img src="${study.icon}" style="width: 40px; height: 40px; object-fit: contain;">
                    <span style="font-size: 12px; color: #45b000;">âœ“ Icon selected</span>
                  </div>
                ` : ''}
              </div>
            </div>
          `).join('')}
          
          ${section.studies.length < 6 ? `
            <button class="btn-primary" onclick="addCaseStudy();">Add Case Study</button>
          ` : ''}
        </div>
      `;
    }

    function addCaseStudy() {
      state.sections.caseStudies.studies.push({ 
        id: Date.now(), 
        heading: '', 
        subheading: '', 
        icon: '',
        file: null,
        fileType: null 
      });
      render();
    }

    function removeCaseStudy(idx) {
      state.sections.caseStudies.studies.splice(idx, 1);
      render();
    }

    async function uploadCaseFile(idx, input) {
      if (input.files[0]) {
        const file = input.files[0];
        const base64 = await handleFileUpload(file);
        state.sections.caseStudies.studies[idx].file = base64;
        state.sections.caseStudies.studies[idx].fileType = file.type;
        render();
      }
    }

    function showIconPicker(idx) {
      const iconGrid = state.availableIcons.map((iconName) => `
        <div class="icon-option" onclick="selectIcon(${idx}, 'Assets/Icons/${iconName}');">
          <img src="Assets/Icons/${iconName}" alt="${iconName}">
          <div class="icon-name">${iconName.replace('.svg', '').replace(/-/g, ' ')}</div>
        </div>
      `).join('');
      
      openModal(`
        <h3 style="margin-bottom: 20px; text-align: center;">Select an Icon</h3>
        <div class="icon-picker">
          ${iconGrid}
        </div>
      `);
    }

    function selectIcon(idx, iconPath) {
      state.sections.caseStudies.studies[idx].icon = iconPath;
      closeModal();
      render();
    }

    function renderFaqEditor() {
      const section = state.sections.faq;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">FAQ</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('faq', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('faq', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          ${state.faqFiles.length > 0 ? `
            <div class="form-group">
              <label class="form-label">Load Pre-built FAQ Set</label>
              <select class="form-select" onchange="loadFAQSet(this.value);">
                <option value="">-- Choose an FAQ set --</option>
                ${state.faqFiles.map(file => `
                  <option value="${file.name}">${file.name.replace('.json', '').replace(/-/g, ' ')}</option>
                `).join('')}
              </select>
              <p style="font-size: 12px; color: #666; margin-top: 6px;">Select a pre-built FAQ to populate questions below</p>
            </div>
          ` : ''}
          
          ${section.questions.map((q, idx) => `
            <div class="item-card">
              <div class="item-header">
                <strong>Question ${idx + 1}</strong>
                <button class="btn-danger" onclick="removeFAQ(${idx});">Remove</button>
              </div>
              
              <div class="form-group">
                <label class="form-label">Question</label>
                <input type="text" class="form-input" value="${q.question || ''}" placeholder="Question"
                       onblur="state.sections.faq.questions[${idx}].question = this.value; render();">
              </div>
              
              <div class="form-group">
                <label class="form-label">Answer</label>
                <textarea class="form-textarea" placeholder="Answer"
                          onblur="state.sections.faq.questions[${idx}].answer = this.value; render();">${q.answer || ''}</textarea>
              </div>
            </div>
          `).join('')}
          
          ${section.questions.length < 10 ? `
            <button class="btn-primary" onclick="addFAQ();">Add FAQ Question</button>
          ` : ''}
        </div>
      `;
    }

    function loadFAQSet(fileName) {
      if (!fileName) return;
      const faqFile = state.faqFiles.find(f => f.name === fileName);
      if (faqFile && faqFile.data) {
        let questions = [];
        if (Array.isArray(faqFile.data)) {
            questions = faqFile.data.map(q => ({ question: q.question, answer: q.answer }));
        } else if (faqFile.data.questions) {
          questions = faqFile.data.questions;
        } else if (faqFile.data.faqVersion && faqFile.data.faqVersion.questions) {
          questions = faqFile.data.faqVersion.questions;
        } else {
          const values = Object.values(faqFile.data);
          for (const val of values) {
            if (val && Array.isArray(val.questions)) {
              questions = val.questions;
              break;
            }
          }
        }
        
        state.sections.faq.questions = questions.map(q => ({
          question: q.question || '',
          answer: q.answer || ''
        }));
        render();
      }
    }

    function addFAQ() {
      state.sections.faq.questions.push({ question: '', answer: '' });
      render();
    }

    function removeFAQ(idx) {
      state.sections.faq.questions.splice(idx, 1);
      render();
    }

    function renderSurpriseEditor() {
      const section = state.sections.surprise;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Surprise & Delight</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('surprise', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('surprise', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">Fulfillment Email</label>
            <input type="email" class="form-input" value="${section.email}" placeholder="fulfillment@precisionaq.com"
                   onblur="updateSection('surprise', 'email', this.value);">
            <p style="font-size: 12px; color: #666; margin-top: 6px;">Requests will be sent to this email address</p>
          </div>
          
          <div class="form-group">
            <label class="form-label">Feature Image (Default: coffee.png)</label>
            <input type="file" class="form-input" accept="image/*"
                   onchange="uploadSurpriseImage(this);">
            ${section.image ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ Image uploaded</p>' : ''}
          </div>
        </div>
      `;
    }

    async function uploadSurpriseImage(input) {
      if (input.files[0]) {
        const base64 = await handleFileUpload(input.files[0]);
        state.sections.surprise.image = base64;
        render();
      }
    }

    function renderCustomizationEditor() {
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Customize & Export</h3>
          <p style="margin-bottom: 20px; color: #666; font-size: 14px;">Control which sections appear on your landing page and their order.</p>
          
          <table class="custom-table">
            <thead>
              <tr>
                <th>Section Name</th>
                <th style="text-align: center;">Visible</th>
                <th style="text-align: center;">Order</th>
              </tr>
            </thead>
            <tbody>
              ${state.customization.sectionOrder.map((key, idx) => `
                <tr>
                  <td>
                    <input type="text" class="form-input" value="${state.customization.sectionNames[key]}"
                           onblur="state.customization.sectionNames['${key}'] = this.value; render();">
                  </td>
                  <td style="text-align: center;">
                    <input type="checkbox" class="form-checkbox" 
                           ${state.customization.sectionVisibility[key] ? 'checked' : ''}
                           onchange="state.customization.sectionVisibility['${key}'] = this.checked; render();">
                  </td>
                  <td style="text-align: center;">
                    <button ${idx === 0 ? 'disabled' : ''} 
                            style="margin: 0 4px; padding: 6px 10px; cursor: ${idx === 0 ? 'not-allowed' : 'pointer'}; border: 1px solid #ddd; background: ${idx === 0 ? '#f5f5f5' : 'white'}; border-radius: 4px;"
                            onclick="moveSection(${idx}, -1);">â–²</button>
                    <button ${idx === state.customization.sectionOrder.length - 1 ? 'disabled' : ''}
                            style="margin: 0 4px; padding: 6px 10px; cursor: ${idx === state.customization.sectionOrder.length - 1 ? 'not-allowed' : 'pointer'}; border: 1px solid #ddd; background: ${idx === state.customization.sectionOrder.length - 1 ? '#f5f5f5' : 'white'}; border-radius: 4px;"
                            onclick="moveSection(${idx}, 1);">â–¼</button>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
          
          <button class="btn-export" onclick="exportWebsite();">ðŸ“¥ Export Landing Page</button>
          <p style="margin-top: 16px; font-size: 13px; color: #666; text-align: center;">
            Downloads a single, self-contained HTML file
          </p>
        </div>
      `;
    }

    function moveSection(idx, direction) {
      const newIdx = idx + direction;
      if (newIdx >= 0 && newIdx < state.customization.sectionOrder.length) {
        [state.customization.sectionOrder[idx], state.customization.sectionOrder[newIdx]] = 
        [state.customization.sectionOrder[newIdx], state.customization.sectionOrder[idx]];
        render();
      }
    }

    function renderPreviewPanel() {
      const visibleSections = state.customization.sectionOrder.filter(
        key => state.customization.sectionVisibility[key]
      );
      
      return `
        <div class="preview-panel">
          <div class="preview-header">
            <div class="nav">
              <img src="${state.logoBase64}" alt="Precision AQ" class="logo">
              <div class="menu">
                ${visibleSections.map(key => `
                  <a href="#${key}" onclick="event.preventDefault(); document.getElementById('${key}').scrollIntoView({behavior: 'smooth'});">
                    ${state.customization.sectionNames[key]}
                  </a>
                `).join('')}
              </div>
            </div>
          </div>
          
          ${visibleSections.map(key => renderPreviewSection(key)).join('')}
        </div>
      `;
    }

    function renderPreviewSection(key) {
      const section = state.sections[key];
      
      switch(key) {
        case 'hero':
          return `
            <div id="hero" class="section preview-section hero">
              <h1>${section.headline}</h1>
              <p>${section.subheading}</p>
              ${section.showButton ? `
                <a href="${section.buttonLink || '#'}" class="preview-btn btn" target="_blank" rel="noopener">
                  ${section.buttonText}
                </a>
              ` : ''}
              ${section.media ? 
                (section.mediaType?.startsWith('video') ? 
                  `<video controls style="max-width: 90%; margin-top: 40px;"><source src="${section.media}" type="${section.mediaType}"></video>` :
                  `<div style="margin-top: 40px;"><img src="${section.media}" alt="Hero" style="max-width: 90%; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.3);"></div>`
                ) : ''
              }
            </div>
          `;
          
        case 'pitch':
          return `
            <div id="pitch" class="section preview-section">
              <h2>${section.headline}</h2>
              <p class="subheading">${section.subheading}</p>
              ${section.media ? `
                <div style="text-align: center; margin-top: 30px;">
                  <button class="btn-primary" onclick="openModal('pitch');" style="cursor: pointer; border: none; font-family: inherit;">
                    ðŸ“„ View Presentation
                  </button>
                </div>
                <div id="modal-pitch" class="modal-overlay" onclick="if(event.target === this) closeModal('pitch');">
                  <div class="modal-content">
                    <button class="modal-close" onclick="closeModal('pitch');">Ã—</button>
                    <embed src="${section.media}" type="${section.mediaType || 'application/pdf'}" style="width: 100%; height: 85vh;" />
                  </div>
                </div>
              ` : ''}
            </div>
          `;
          
        case 'team':
          if (section.people.length === 0) return '';
          return `
            <div id="team" class="section preview-section" style="background: #f8f9fa;">
              <h2>${section.headline}</h2>
              <p class="subheading">${section.subheading}</p>
              <div class="team-grid">
                ${section.people.map((person, idx) => `
                  <div class="team-card" id="team-card-${idx}" onclick="this.classList.toggle('expanded');">
                    <div class="team-avatar">
                      ${person.image ? `<img src="${person.image}" alt="${person.name}">` : ''}
                    </div>
                    <h3>${person.name}</h3>
                    <p>${person.title}</p>
                    ${person.linkedin ? `<a href="${person.linkedin}" target="_blank" onclick="event.stopPropagation();" style="color: #cb009f; font-size: 14px; text-decoration: none; margin-top: 10px; display: inline-block;">LinkedIn â†’</a>` : ''}
                    ${person.bio ? `
                      <div class="team-bio">
                        <strong style="display: block; margin-bottom: 8px; color: #333;">About:</strong>
                        ${person.bio}
                      </div>
                    ` : ''}
                  </div>
                `).join('')}
              </div>
              <p style="text-align: center; margin-top: 20px; font-size: 14px; color: #666; font-style: italic;">Click on a team member to read their bio</p>
            </div>
          `;
          
        case 'caseStudies':
          if (section.studies.length === 0 || !section.studies.some(s => s.heading)) return '';
          return `
            <div id="caseStudies" class="section preview-section">
              <h2>${section.headline}</h2>
              <p class="subheading">${section.subheading}</p>
              <div class="case-studies-grid">
                ${section.studies.filter(s => s.heading).map((study, idx) => `
                  <div class="case-study-card" ${study.file ? `onclick="openModal('case-${idx}');"` : ''}>
                    ${study.icon ? `<img src="${study.icon}" alt="Icon">` : ''}
                    <h3>${study.heading}</h3>
                    <p>${study.subheading}</p>
                  </div>
                  ${study.file ? `
                    <div id="modal-case-${idx}" class="modal-overlay" onclick="if(event.target === this) closeModal('case-${idx}');">
                      <div class="modal-content">
                        <button class="modal-close" onclick="closeModal('case-${idx}');">Ã—</button>
                        <embed src="${study.file}" type="${study.fileType || 'application/pdf'}" style="width: 100%; height: 85vh;" />
                      </div>
                    </div>
                  ` : ''}
                `).join('')}
              </div>
            </div>
          `;
          
        case 'faq':
          if (section.questions.length === 0) return '';
          return `
            <div id="faq" class="section preview-section" style="background: #f8f9fa;">
              <h2>${section.headline}</h2>
              <p class="subheading">${section.subheading}</p>
              ${section.questions.map((q, idx) => `
                <div class="faq-item">
                  <div class="faq-question" onclick="toggleFAQ(${idx});">
                    ${q.question}
                    <span id="faq-icon-${idx}">â–¼</span>
                  </div>
                  <div class="faq-answer" id="faq-answer-${idx}">${q.answer}</div>
                </div>
              `).join('')}
            </div>
          `;
          
        case 'surprise':
          return `
            <div id="surprise" class="section preview-section">
              <div class="surprise-container">
                <div class="surprise-image">
                  ${section.image ? `<img src="${section.image}" alt="Coffee">` : ''}
                </div>
                <div class="surprise-content">
                  <h2>${section.headline}</h2>
                  <p>${section.subheading}</p>
                  <div class="surprise-form">
                    <div class="surprise-form-row">
                      <input type="text" placeholder="First Name" id="surprise-first">
                      <input type="text" placeholder="Last Name" id="surprise-last">
                    </div>
                    <input type="email" placeholder="Email Address" id="surprise-email">
                    <button onclick="submitSurpriseForm();">Give Me Coffee</button>
                  </div>
                </div>
              </div>
            </div>
          `;
          
        default:
          return '';
      }
    }

    function submitSurpriseForm() {
      const firstName = document.getElementById('surprise-first').value;
      const lastName = document.getElementById('surprise-last').value;
      const email = document.getElementById('surprise-email').value;
      
      if (firstName && lastName && email) {
        const mailtoLink = 'mailto:${state.sections.surprise.email}?subject=Coffee Request&body=First Name: ' + encodeURIComponent(firstName) + '%0D%0ALast Name: ' + encodeURIComponent(lastName) + '%0D%0AEmail: ' + encodeURIComponent(email);
        window.location.href = mailtoLink;
      } else {
        alert('Please fill in all fields');
      }
    }

    function exportWebsite() {
      const visibleSections = state.customization.sectionOrder.filter(
        key => state.customization.sectionVisibility[key]
      );
      
      const exportHTML = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${state.sections.hero.headline} - Precision AQ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Proxima Nova', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      color: #0f1822;
    }
    
    .header {
      position: sticky;
      top: 0;
      background: white;
      padding: 20px 40px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 100;
    }
    .nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }
    .logo {
      height: 40px;
    }
    .menu {
      display: flex;
      gap: 25px;
      flex-wrap: wrap;
    }
    .menu a {
      color: #0f1822;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      transition: color 0.3s;
    }
    .menu a:hover {
      color: #cb009f;
    }
    
    .section {
      padding: 80px 40px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .hero {
      background: linear-gradient(135deg, #cb009f 0%, #850064 100%);
      color: white;
      text-align: center;
      max-width: 100%;
    }
    .hero h1 {
      font-size: 48px;
      margin-bottom: 20px;
      font-weight: bold;
      line-height: 1.2;
    }
    .hero p {
      font-size: 20px;
      margin-bottom: 30px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.6;
    }
    .btn {
      background: white;
      color: #cb009f;
      padding: 14px 32px;
      border-radius: 8px;
      text-decoration: none;
      display: inline-block;
      font-weight: bold;
      font-size: 16px;
      transition: all 0.3s;
      cursor: pointer;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .section h2 {
      font-size: 36px;
      color: #cb009f;
      margin-bottom: 15px;
      font-weight: bold;
    }
    .section .subheading {
      font-size: 18px;
      color: #666;
      margin-bottom: 40px;
      line-height: 1.6;
    }
    
    .team-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 30px;
    }
    .team-card {
      text-align: center;
      padding: 24px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      cursor: pointer;
      transition: all 0.3s;
    }
    .team-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .team-avatar {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: #dcdde1;
      margin: 0 auto 15px;
      overflow: hidden;
    }
    .team-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .team-card h3 {
      color: #cb009f;
      margin-bottom: 5px;
      font-size: 18px;
      font-weight: 600;
    }
    .team-card p {
      color: #666;
      font-size: 14px;
    }
    .team-bio {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #e0e0e0;
      text-align: left;
      font-size: 13px;
      line-height: 1.5;
      color: #666;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .team-card.expanded .team-bio {
      max-height: 500px;
    }
    
    .case-studies-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
    }
    .case-study-card {
      padding: 30px;
      background: #f8f9fa;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      cursor: pointer;
      transition: all 0.3s;
    }
    .case-study-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .case-study-card img {
      width: 60px;
      height: 60px;
      margin-bottom: 15px;
      object-fit: contain;
    }
    .case-study-card h3 {
      color: #cb009f;
      margin-bottom: 12px;
      font-size: 20px;
      font-weight: 600;
    }
    .case-study-card p {
      color: #666;
      font-size: 15px;
      line-height: 1.5;
    }
    
    .faq-item {
      margin-bottom: 15px;
      border: 1px solid #dcdde1;
      border-radius: 8px;
      overflow: hidden;
      background: white;
    }
    .faq-question {
      background: #f8f9fa;
      padding: 20px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 15px;
      color: #333;
      transition: background 0.2s;
    }
    .faq-question:hover {
      background: #e9ecef;
    }
    .faq-answer {
      padding: 20px;
      font-size: 14px;
      color: #666;
      line-height: 1.6;
      display: none;
    }
    .faq-answer.active {
      display: block;
    }
    
    .surprise-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 60px;
      align-items: center;
      max-width: 1000px;
      margin: 0 auto;
    }
    .surprise-image {
      text-align: center;
    }
    .surprise-image img {
      max-width: 100%;
      max-height: 500px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .surprise-content {
      text-align: left;
    }
    .surprise-content h2 {
      font-size: 36px;
      color: #0f1822;
      margin-bottom: 20px;
      text-align: left;
    }
    .surprise-content p {
      font-size: 16px;
      color: #666;
      line-height: 1.6;
      margin-bottom: 30px;
    }
    .surprise-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .surprise-form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    .surprise-form input {
      width: 100%;
      padding: 14px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
    }
    .surprise-form button {
      padding: 16px;
      background: #cb009f;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }
    .surprise-form button:hover {
      background: #850064;
    }
    
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }
    .modal-overlay.active {
      display: flex;
    }
    .modal-content {
      background: white;
      border-radius: 12px;
      max-width: 90%;
      max-height: 90vh;
      overflow: auto;
      position: relative;
      padding: 40px 20px 20px;
    }
    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      font-size: 20px;
      cursor: pointer;
      font-weight: bold;
      z-index: 1;
    }
    .modal-close:hover {
      background: #c82333;
    }
    
    video {
      max-width: 100%;
      border-radius: 12px;
      margin-top: 30px;
    }
    
    @media (max-width: 768px) {
      .hero h1 { font-size: 32px; }
      .hero p { font-size: 16px; }
      .section h2 { font-size: 28px; }
      .surprise-container {
        grid-template-columns: 1fr;
        gap: 30px;
      }
      .surprise-form-row {
        grid-template-columns: 1fr;
      }
      .menu {
        gap: 15px;
      }
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    const state = {
      view: 'home',
      activeSection: 'hero',
      sections: {
        hero: {
          headline: "Thanks for having us!",
          subheading: "It was an honor and a privilege to be able to be considered for your RFP and the time to share our thinking with you. In case you forgot anything we shared, please have a look around.",
          showButton: true,
          buttonText: "Be in Touch",
          buttonLink: "",
          media: null,
          mediaType: null
        },
        pitch: {
          headline: "What we shared with you",
          subheading: "In case you missed it, here's a refresher of what we shared with you in our presentation",
          media: null,
          mediaType: null
        },
        team: {
          headline: "Meet Your Team",
          subheading: "The folks on your side throughout the work",
          people: []
        },
        caseStudies: {
          headline: "Show Your Work",
          subheading: "We have loads of experience and here are some relevant case studies from our recent work",
          studies: []
        },
        faq: {
          headline: "Learn more about Precision AQ",
          subheading: "additional background on Precision AQ and other things",
          questions: []
        },
        surprise: {
          headline: "Know what's keeping you up at night",
          subheading: "With our partnership, you can sleep easy knowing we have your back. Now, the only thing keeping you up will be the coffee!",
          image: null,
          email: ""
        }
      },
      customization: {
        sectionOrder: ['hero', 'pitch', 'team', 'caseStudies', 'faq', 'surprise'],
        sectionVisibility: {
          hero: true,
          pitch: true,
          team: true,
          caseStudies: true,
          faq: true,
          surprise: true
        },
        sectionNames: {
          hero: 'Hero Header',
          pitch: 'Pitch Materials',
          team: 'Team Bios',
          caseStudies: 'Case Studies',
          faq: 'FAQ',
          surprise: 'Surprise & Delight'
        }
      },
      logoBase64: '',
      teamBiosData: [],
      faqFiles: [],
      availableIcons: [],
      modal: null 
    };

    async function loadAssets() {
      try {
        const logoResponse = await fetch('Assets/PAQ-logo.png');
        if (logoResponse.ok) {
          const logoBlob = await logoResponse.blob();
          state.logoBase64 = await new Promise((resolve) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result);
            reader.readAsDataURL(logoBlob);
          });
        }
        
        const coffeeResponse = await fetch('Assets/coffee.png');
        if (coffeeResponse.ok) {
          const coffeeBlob = await coffeeResponse.blob();
          state.sections.surprise.image = await new Promise((resolve) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result);
            reader.readAsDataURL(coffeeBlob);
          });
        }
        
        const csvResponse = await fetch('Assets/Bios/team-bios.csv');
        if (csvResponse.ok) {
          const csvText = await csvResponse.text();
          state.teamBiosData = parseCSV(csvText);
        }
        
        try {
          const faqFiles = ['peanuts-faq.json', 'precision-aq-faq.json'];
          for (const file of faqFiles) {
            try {
              const response = await fetch(`Assets/FAQs/${file}`);
              if (response.ok) {
                state.faqFiles.push({ name: file, data: await response.json() });
              }
            } catch (e) {}
          }
        } catch (e) {}
        
        const iconNames = [
          'Add-Circle-Bold.svg', 'Alarm-Bell-Ring.svg', 'Alert-Bell-Notification-2.svg', 
          'Alert-Octagon-1.svg', 'Ampersand.svg', 'Arrange-Letter.svg', 
          'Arrange-List-Descending.svg', 'Arrange-Number-Descending.svg', 'Attachment.svg',
          'Bill-Cross.svg', 'Bin-1.svg', 'Binocular.svg', 'Blood-Bag-Cross.svg',
          'Book-Close-Bookmark-1.svg', 'Book-Open-Bookmark.svg', 'Bookmark-Cancel-Delete.svg',
          'Bookmarks-Document.svg', 'Branch-Line-5.svg', 'Brightness.svg',
          'Button-Fast-Forward-1.svg', 'Button-Loop.svg', 'Button-Play.svg',
          'Button-Stop.svg', 'Button-Zigzag-1.svg', 'Calendar-3.svg',
          'Calendar-Edit-1.svg', 'Cell-Border-Frame.svg', 'Check-Badge.svg',
          'Check-Double.svg', 'Check-Square.svg', 'Checklist.svg',
          'Checkup-Chart.svg', 'Coding-Apps-Website-Web-Form-Text-Area-1.svg',
          'Cog-Hand-Give-1.svg', 'Cog-Search-1.svg', 'Cog.svg',
          'Command-Button-Keyboard.svg', 'Cursor-Hand-2.svg', 'Cursor-Speed-2.svg',
          'Cursor-Target-1.svg', 'Cursor.svg', 'Delete-2.svg', 'Delete.svg',
          'Diagnostic-Desktop.svg', 'Dial-Finger-1.svg', 'Dial-Pad.svg',
          'Direction-Button-2.svg', 'Direction-Button-3.svg', 'Division-Math-Symbol-Circle.svg',
          'Duplicate.svg', 'Equal-Math-Symbol-Circle.svg', 'Expand-2.svg',
          'Expand-Full.svg', 'Face-Id-1.svg', 'Filter-1.svg',
          'Filter-Sort-Lines-Descending.svg', 'Gauge-Dashboard.svg', 'Hand-Drag.svg',
          'Hospital-Building-Pin.svg', 'Hospital-Sign.svg', 'Insurance-Hand.svg',
          'Insurance-Head.svg', 'Iris-Scan-1.svg', 'Lab-Tube-Experiment.svg',
          'Lab-Tube.svg', 'Lock-Shield.svg', 'Lock-Unlock-4.svg', 'Login-Key.svg',
          'Medical-App-Laptop-1.svg', 'Medical-Specialty-Knee-1.svg', 'Megaphone.svg',
          'Multiple-Users-1.svg', 'Multiple-Users-Network.svg', 'Paper-Write.svg',
          'Pen-Write.svg', 'Pencil-1.svg', 'Petri-Dish-2.svg', 'Plus-One-Increment.svg',
          'Radioactive-Circle.svg', 'Radiology-Scan-Doctor.svg', 'Satellite.svg',
          'Science-Molecule-Strucutre.svg', 'Science-Molecule.svg', 'Search-Circle.svg',
          'Settings-Slider-Desktop-Horizontal.svg', 'Share.svg', 'Shrink.svg',
          'Skull-1.svg', 'Stopwatch.svg', 'Synchronize-Arrows-Three.svg',
          'Tags-Favorite.svg', 'Time-Clock-Fire.svg', 'Time-Daily-1.svg',
          'Tool-Box.svg', 'User-Question.svg', 'User-Signal-1.svg',
          'View-Square.svg', 'Voice-Id-Approved.svg', 'Voice-Id.svg', 'Wifi-Signal-2.svg'
        ];
        
        state.availableIcons = iconNames;
        
      } catch (e) {
        console.log('Some assets not found');
      }
      render();
    }

    function parseCSV(text) {
      const lines = text.trim().split('\n');
      const headers = lines[0].split(',').map(h => h.trim());
      return lines.slice(1).map(line => {
        const values = line.split(',');
        return headers.reduce((obj, header, index) => {
          obj[header] = values[index]?.trim() || '';
          return obj;
        }, {});
      });
    }

    async function handleFileUpload(file) {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result);
        reader.readAsDataURL(file);
      });
    }

    function updateSection(sectionKey, field, value) {
      state.sections[sectionKey][field] = value;
      render();
    }

    function openModal(content) {
      state.modal = content;
      render();
    }

    function closeModal() {
      state.modal = null;
      render();
    }

    function renderHome() {
      return `
        <div class="home-view">
          <div class="home-content">
            <h1 class="home-title">Precision AQ<br/>Landing Page Builder</h1>
            <p class="home-desc">
              Create customized landing pages for your RFP responses with an intuitive interface. Export as a single, self-contained HTML file.
            </p>
            <button class="home-btn" onclick="state.view='builder'; render();">
              Start A Project
            </button>
          </div>
          <div class="home-footer">Built by Jack</div>
        </div>
      `;
    }

    function renderBuilder() {
      return `
        <div class="builder-view">
          ${renderEditorPanel()}
          ${renderPreviewPanel()}
        </div>
        ${state.modal ? renderModal() : ''}
      `;
    }

    function renderModal() {
      return `
        <div class="modal-overlay" onclick="if(event.target === this) closeModal();">
          <div class="modal-content">
            <button class="modal-close" onclick="closeModal();">Ã—</button>
            ${state.modal}
          </div>
        </div>
      `;
    }

    function renderEditorPanel() {
      return `
        <div class="editor-panel">
          <div class="editor-header">
            <h2 class="editor-title">Website Builder</h2>
            <p class="editor-subtitle">Edit your landing page sections below</p>
          </div>
          ${renderTabs()}
          ${renderActiveEditor()}
        </div>
      `;
    }

    function renderTabs() {
      const tabs = ['hero', 'pitch', 'team', 'caseStudies', 'faq', 'surprise', 'customization'];
      return `
        <div class="tabs">
          ${tabs.map(tab => `
            <button class="tab ${state.activeSection === tab ? 'active' : ''}" 
                    onclick="state.activeSection='${tab}'; render();">
              ${tab === 'customization' ? 'Customize & Export' : state.customization.sectionNames[tab]}
            </button>
          `).join('')}
        </div>
      `;
    }

    function renderActiveEditor() {
      switch(state.activeSection) {
        case 'hero': return renderHeroEditor();
        case 'pitch': return renderPitchEditor();
        case 'team': return renderTeamEditor();
        case 'caseStudies': return renderCaseStudiesEditor();
        case 'faq': return renderFaqEditor();
        case 'surprise': return renderSurpriseEditor();
        case 'customization': return renderCustomizationEditor();
        default: return '';
      }
    }

    function renderHeroEditor() {
      const section = state.sections.hero;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Hero Section</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}" 
                   onblur="updateSection('hero', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea" 
                      onblur="updateSection('hero', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" class="form-checkbox" ${section.showButton ? 'checked' : ''}
                     onchange="updateSection('hero', 'showButton', this.checked);">
              <span>Show Call-to-Action Button</span>
            </label>
          </div>
          
          ${section.showButton ? `
            <div class="form-group">
              <label class="form-label">Button Text</label>
              <input type="text" class="form-input" value="${section.buttonText}"
                     onblur="updateSection('hero', 'buttonText', this.value);">
            </div>
            
            <div class="form-group">
              <label class="form-label">Button Link URL</label>
              <input type="url" class="form-input" value="${section.buttonLink}" placeholder="https://example.com"
                     onblur="updateSection('hero', 'buttonLink', this.value);">
            </div>
          ` : ''}
          
          <div class="form-group">
            <label class="form-label">Hero Image/Video (.mp4)</label>
            <input type="file" class="form-input" accept="image/*,video/mp4"
                   onchange="handleHeroMedia(this);">
            ${section.media ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ Media uploaded</p>' : ''}
          </div>
        </div>
      `;
    }

    async function handleHeroMedia(input) {
      if (input.files[0]) {
        const file = input.files[0];
        const base64 = await handleFileUpload(file);
        state.sections.hero.media = base64;
        state.sections.hero.mediaType = file.type;
        render();
      }
    }

    function renderPitchEditor() {
      const section = state.sections.pitch;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Pitch Materials</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('pitch', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('pitch', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">Presentation Materials (PDF or PowerPoint only)</label>
            <input type="file" class="form-input" accept=".pdf,.ppt,.pptx"
                   onchange="handlePitchMedia(this);">
            ${section.media ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ File uploaded</p>' : ''}
          </div>
        </div>
      `;
    }

    async function handlePitchMedia(input) {
      if (input.files[0]) {
        const file = input.files[0];
        const base64 = await handleFileUpload(file);
        state.sections.pitch.media = base64;
        state.sections.pitch.mediaType = file.type;
        render();
      }
    }

    function renderTeamEditor() {
      const section = state.sections.team;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Team Bios</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('team', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('team', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          <div style="margin-bottom: 20px;">
            <h4 style="margin-bottom: 16px; font-size: 16px; font-weight: 600;">Team Members (${section.people.length}/10)</h4>
            ${section.people.map((person, idx) => `
              <div class="item-card">
                <div class="item-header">
                  <strong>${person.name || `Person ${idx + 1}`}</strong>
                  <button class="btn-danger" onclick="removeTeamMember(${idx});">Remove</button>
                </div>
                
                ${state.teamBiosData.length > 0 ? `
                  <div class="form-group">
                    <label class="form-label">Select Team Member from CSV</label>
                    <select class="form-select" onchange="loadTeamBio(${idx}, this.value);">
                      <option value="">-- Choose a team member --</option>
                      ${state.teamBiosData.map(bio => `
                        <option value="${bio.Name}" ${person.csvId === bio.Name ? 'selected' : ''}>
                          ${bio.Name}
                        </option>
                      `).join('')}
                    </select>
                  </div>
                ` : ''}
                
                <div class="form-group">
                  <label class="form-label">Name</label>
                  <input type="text" class="form-input" value="${person.name || ''}" placeholder="Name"
                         onblur="state.sections.team.people[${idx}].name = this.value; render();">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Title</label>
                  <input type="text" class="form-input" value="${person.title || ''}" placeholder="Title"
                         onblur="state.sections.team.people[${idx}].title = this.value; render();">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Bio</label>
                  <textarea class="form-textarea" placeholder="Bio text..."
                            onblur="state.sections.team.people[${idx}].bio = this.value; render();">${person.bio || ''}</textarea>
                </div>
                
                <div class="form-group">
                  <label class="form-label">LinkedIn URL</label>
                  <input type="url" class="form-input" value="${person.linkedin || ''}" placeholder="https://linkedin.com/in/..."
                         onblur="state.sections.team.people[${idx}].linkedin = this.value; render();">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Photo</label>
                  <input type="file" class="form-input" accept="image/*"
                         onchange="uploadTeamPhoto(${idx}, this);">
                  ${person.image ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ Photo uploaded</p>' : ''}
                </div>
              </div>
            `).join('')}
            
            ${section.people.length < 10 ? `
              <button class="btn-primary" onclick="addTeamMember();">+ Add Team Member</button>
            ` : ''}
          </div>
        </div>
      `;
    }

    function addTeamMember() {
      state.sections.team.people.push({ name: '', title: '', bio: '', image: null, linkedin: '', csvId: null });
      render();
    }

    function removeTeamMember(idx) {
      state.sections.team.people.splice(idx, 1);
      render();
    }

    async function loadTeamBio(idx, name) {
      const bio = state.teamBiosData.find(b => b.Name === name);
      if (bio) {
        const person = state.sections.team.people[idx];
        person.name = bio.Name;
        person.title = bio.Title;
        person.bio = bio.Bio;
        person.linkedin = bio.LinkedIn;
        person.csvId = bio.Name;
        
        if (bio.Image) {
          try {
            const imgResponse = await fetch(`Assets/Bios/bio-images/${bio.Image}`);
            if (imgResponse.ok) {
              const imgBlob = await imgResponse.blob();
              person.image = await new Promise((resolve) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.readAsDataURL(imgBlob);
              });
            }
          } catch (e) {
            console.log('Image not found');
          }
        }
        render();
      }
    }

    async function uploadTeamPhoto(idx, input) {
      if (input.files[0]) {
        const base64 = await handleFileUpload(input.files[0]);
        state.sections.team.people[idx].image = base64;
        state.sections.team.people[idx].csvId = null; 
        render();
      }
    }

    function renderCaseStudiesEditor() {
      const section = state.sections.caseStudies;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Case Studies</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('caseStudies', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('caseStudies', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          ${section.studies.map((study, idx) => `
            <div class="item-card">
              <div class="item-header">
                <strong>Case Study ${idx + 1}</strong>
                <button class="btn-danger" onclick="removeCaseStudy(${idx});">Remove</button>
              </div>
              
              <div class="form-group">
                <label class="form-label">Heading</label>
                <input type="text" class="form-input" value="${study.heading || ''}" placeholder="Heading"
                       onblur="state.sections.caseStudies.studies[${idx}].heading = this.value; render();">
              </div>
              
              <div class="form-group">
                <label class="form-label">Description</label>
                <textarea class="form-textarea" placeholder="Description"
                          onblur="state.sections.caseStudies.studies[${idx}].subheading = this.value; render();">${study.subheading || ''}</textarea>
              </div>
              
              <div class="form-group">
                <label class="form-label">Case Study File (PDF, Image, Video)</label>
                <input type="file" class="form-input" accept=".pdf,image/*,video/*"
                       onchange="uploadCaseFile(${idx}, this);">
                ${study.file ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ File uploaded</p>' : ''}
              </div>
              
              <div class="form-group">
                <label class="form-label">Icon</label>
                <button class="btn-primary" onclick="showIconPicker(${idx});" style="width: auto;">Choose Icon</button>
                ${study.icon ? `
                  <div style="margin-top: 10px; display: flex; align-items: center; gap: 10px;">
                    <img src="${study.icon}" style="width: 40px; height: 40px; object-fit: contain;">
                    <span style="font-size: 12px; color: #45b000;">âœ“ Icon selected</span>
                  </div>
                ` : ''}
              </div>
            </div>
          `).join('')}
          
          ${section.studies.length < 6 ? `
            <button class="btn-primary" onclick="addCaseStudy();">Add Case Study</button>
          ` : ''}
        </div>
      `;
    }

    function addCaseStudy() {
      state.sections.caseStudies.studies.push({ 
        id: Date.now(), 
        heading: '', 
        subheading: '', 
        icon: '',
        file: null,
        fileType: null 
      });
      render();
    }

    function removeCaseStudy(idx) {
      state.sections.caseStudies.studies.splice(idx, 1);
      render();
    }

    async function uploadCaseFile(idx, input) {
      if (input.files[0]) {
        const file = input.files[0];
        const base64 = await handleFileUpload(file);
        state.sections.caseStudies.studies[idx].file = base64;
        state.sections.caseStudies.studies[idx].fileType = file.type;
        render();
      }
    }

    function showIconPicker(idx) {
      const iconGrid = state.availableIcons.map((iconName) => `
        <div class="icon-option" onclick="selectIcon(${idx}, 'Assets/Icons/${iconName}');">
          <img src="Assets/Icons/${iconName}" alt="${iconName}">
          <div class="icon-name">${iconName.replace('.svg', '').replace(/-/g, ' ')}</div>
        </div>
      `).join('');
      
      openModal(`
        <h3 style="margin-bottom: 20px; text-align: center;">Select an Icon</h3>
        <div class="icon-picker">
          ${iconGrid}
        </div>
      `);
    }

    function selectIcon(idx, iconPath) {
      state.sections.caseStudies.studies[idx].icon = iconPath;
      closeModal();
      render();
    }

    function renderFaqEditor() {
      const section = state.sections.faq;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">FAQ</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('faq', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('faq', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          ${state.faqFiles.length > 0 ? `
            <div class="form-group">
              <label class="form-label">Load Pre-built FAQ Set</label>
              <select class="form-select" onchange="loadFAQSet(this.value);">
                <option value="">-- Choose an FAQ set --</option>
                ${state.faqFiles.map(file => `
                  <option value="${file.name}">${file.name.replace('.json', '').replace(/-/g, ' ')}</option>
                `).join('')}
              </select>
              <p style="font-size: 12px; color: #666; margin-top: 6px;">Select a pre-built FAQ to populate questions below</p>
            </div>
          ` : ''}
          
          ${section.questions.map((q, idx) => `
            <div class="item-card">
              <div class="item-header">
                <strong>Question ${idx + 1}</strong>
                <button class="btn-danger" onclick="removeFAQ(${idx});">Remove</button>
              </div>
              
              <div class="form-group">
                <label class="form-label">Question</label>
                <input type="text" class="form-input" value="${q.question || ''}" placeholder="Question"
                       onblur="state.sections.faq.questions[${idx}].question = this.value; render();">
              </div>
              
              <div class="form-group">
                <label class="form-label">Answer</label>
                <textarea class="form-textarea" placeholder="Answer"
                          onblur="state.sections.faq.questions[${idx}].answer = this.value; render();">${q.answer || ''}</textarea>
              </div>
            </div>
          `).join('')}
          
          ${section.questions.length < 10 ? `
            <button class="btn-primary" onclick="addFAQ();">Add FAQ Question</button>
          ` : ''}
        </div>
      `;
    }

    function loadFAQSet(fileName) {
      if (!fileName) return;
      const faqFile = state.faqFiles.find(f => f.name === fileName);
      if (faqFile && faqFile.data) {
        let questions = [];
        if (Array.isArray(faqFile.data)) {
            questions = faqFile.data.map(q => ({ question: q.question, answer: q.answer }));
        } else if (faqFile.data.questions) {
          questions = faqFile.data.questions;
        } else if (faqFile.data.faqVersion && faqFile.data.faqVersion.questions) {
          questions = faqFile.data.faqVersion.questions;
        } else {
          const values = Object.values(faqFile.data);
          for (const val of values) {
            if (val && Array.isArray(val.questions)) {
              questions = val.questions;
              break;
            }
          }
        }
        
        state.sections.faq.questions = questions.map(q => ({
          question: q.question || '',
          answer: q.answer || ''
        }));
        render();
      }
    }

    function addFAQ() {
      state.sections.faq.questions.push({ question: '', answer: '' });
      render();
    }

    function removeFAQ(idx) {
      state.sections.faq.questions.splice(idx, 1);
      render();
    }

    function renderSurpriseEditor() {
      const section = state.sections.surprise;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Surprise & Delight</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('surprise', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('surprise', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">Fulfillment Email</label>
            <input type="email" class="form-input" value="${section.email}" placeholder="fulfillment@precisionaq.com"
                   onblur="updateSection('surprise', 'email', this.value);">
            <p style="font-size: 12px; color: #666; margin-top: 6px;">Requests will be sent to this email address</p>
          </div>
          
          <div class="form-group">
            <label class="form-label">Feature Image (Default: coffee.png)</label>
            <input type="file" class="form-input" accept="image/*"
                   onchange="uploadSurpriseImage(this);">
            ${section.image ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ Image uploaded</p>' : ''}
          </div>
        </div>
      `;
    }

    async function uploadSurpriseImage(input) {
      if (input.files[0]) {
        const base64 = await handleFileUpload(input.files[0]);
        state.sections.surprise.image = base64;
        render();
      }
    }

    function renderCustomizationEditor() {
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Customize & Export</h3>
          <p style="margin-bottom: 20px; color: #666; font-size: 14px;">Control which sections appear on your landing page and their order.</p>
          
          <table class="custom-table">
            <thead>
              <tr>
                <th>Section Name</th>
                <th style="text-align: center;">Visible</th>
                <th style="text-align: center;">Order</th>
              </tr>
            </thead>
            <tbody>
              ${state.customization.sectionOrder.map((key, idx) => `
                <tr>
                  <td>
                    <input type="text" class="form-input" value="${state.customization.sectionNames[key]}"
                           onblur="state.customization.sectionNames['${key}'] = this.value; render();">
                  </td>
                  <td style="text-align: center;">
                    <input type="checkbox" class="form-checkbox" 
                           ${state.customization.sectionVisibility[key] ? 'checked' : ''}
                           onchange="state.customization.sectionVisibility['${key}'] = this.checked; render();">
                  </td>
                  <td style="text-align: center;">
                    <button ${idx === 0 ? 'disabled' : ''} 
                            style="margin: 0 4px; padding: 6px 10px; cursor: ${idx === 0 ? 'not-allowed' : 'pointer'}; border: 1px solid #ddd; background: ${idx === 0 ? '#f5f5f5' : 'white'}; border-radius: 4px;"
                            onclick="moveSection(${idx}, -1);">â–²</button>
                    <button ${idx === state.customization.sectionOrder.length - 1 ? 'disabled' : ''}
                            style="margin: 0 4px; padding: 6px 10px; cursor: ${idx === state.customization.sectionOrder.length - 1 ? 'not-allowed' : 'pointer'}; border: 1px solid #ddd; background: ${idx === state.customization.sectionOrder.length - 1 ? '#f5f5f5' : 'white'}; border-radius: 4px;"
                            onclick="moveSection(${idx}, 1);">â–¼</button>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
          
          <button class="btn-export" onclick="exportWebsite();">ðŸ“¥ Export Landing Page</button>
          <p style="margin-top: 16px; font-size: 13px; color: #666; text-align: center;">
            Downloads a single, self-contained HTML file
          </p>
        </div>
      `;
    }

    function moveSection(idx, direction) {
      const newIdx = idx + direction;
      if (newIdx >= 0 && newIdx < state.customization.sectionOrder.length) {
        [state.customization.sectionOrder[idx], state.customization.sectionOrder[newIdx]] = 
        [state.customization.sectionOrder[newIdx], state.customization.sectionOrder[idx]];
        render();
      }
    }

    function renderPreviewPanel() {
      const visibleSections = state.customization.sectionOrder.filter(
        key => state.customization.sectionVisibility[key]
      );
      
      return `
        <div class="preview-panel">
          <div class="preview-header">
            <div class="nav">
              <img src="${state.logoBase64}" alt="Precision AQ" class="logo">
              <div class="menu">
                ${visibleSections.map(key => `
                  <a href="#${key}" onclick="event.preventDefault(); document.getElementById('${key}').scrollIntoView({behavior: 'smooth'});">
                    ${state.customization.sectionNames[key]}
                  </a>
                `).join('')}
              </div>
            </div>
          </div>
          
          ${visibleSections.map(key => renderPreviewSection(key)).join('')}
        </div>
      `;
    }

    function renderPreviewSection(key) {
      const section = state.sections[key];
      
      switch(key) {
        case 'hero':
          return `
            <div id="hero" class="section preview-section hero">
              <h1>${section.headline}</h1>
              <p>${section.subheading}</p>
              ${section.showButton ? `
                <a href="${section.buttonLink || '#'}" class="preview-btn btn" target="_blank" rel="noopener">
                  ${section.buttonText}
                </a>
              ` : ''}
              ${section.media ? 
                (section.mediaType?.startsWith('video') ? 
                  `<video controls style="max-width: 90%; margin-top: 40px;"><source src="${section.media}" type="${section.mediaType}"></video>` :
                  `<div style="margin-top: 40px;"><img src="${section.media}" alt="Hero" style="max-width: 90%; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.3);"></div>`
                ) : ''
              }
            </div>
          `;
          
        case 'pitch':
          return `
            <div id="pitch" class="section preview-section">
              <h2>${section.headline}</h2>
              <p class="subheading">${section.subheading}</p>
              ${section.media ? `
                <div style="text-align: center; margin-top: 30px;">
                  <button class="btn-primary" onclick="openModal('pitch');" style="cursor: pointer; border: none; font-family: inherit;">
                    ðŸ“„ View Presentation
                  </button>
                </div>
                <div id="modal-pitch" class="modal-overlay" onclick="if(event.target === this) closeModal('pitch');">
                  <div class="modal-content">
                    <button class="modal-close" onclick="closeModal('pitch');">Ã—</button>
                    <embed src="${section.media}" type="${section.mediaType || 'application/pdf'}" style="width: 100%; height: 85vh;" />
                  </div>
                </div>
              ` : ''}
            </div>
          `;
          
        case 'team':
          if (section.people.length === 0) return '';
          return `
            <div id="team" class="section preview-section" style="background: #f8f9fa;">
              <h2>${section.headline}</h2>
              <p class="subheading">${section.subheading}</p>
              <div class="team-grid">
                ${section.people.map((person, idx) => `
                  <div class="team-card" id="team-card-${idx}" onclick="this.classList.toggle('expanded');">
                    <div class="team-avatar">
                      ${person.image ? `<img src="${person.image}" alt="${person.name}">` : ''}
                    </div>
                    <h3>${person.name}</h3>
                    <p>${person.title}</p>
                    ${person.linkedin ? `<a href="${person.linkedin}" target="_blank" onclick="event.stopPropagation();" style="color: #cb009f; font-size: 14px; text-decoration: none; margin-top: 10px; display: inline-block;">LinkedIn â†’</a>` : ''}
                    ${person.bio ? `
                      <div class="team-bio">
                        <strong style="display: block; margin-bottom: 8px; color: #333;">About:</strong>
                        ${person.bio}
                      </div>
                    ` : ''}
                  </div>
                `).join('')}
              </div>
              <p style="text-align: center; margin-top: 20px; font-size: 14px; color: #666; font-style: italic;">Click on a team member to read their bio</p>
            </div>
          `;
          
        case 'caseStudies':
          if (section.studies.length === 0 || !section.studies.some(s => s.heading)) return '';
          return `
            <div id="caseStudies" class="section preview-section">
              <h2>${section.headline}</h2>
              <p class="subheading">${section.subheading}</p>
              <div class="case-studies-grid">
                ${section.studies.filter(s => s.heading).map((study, idx) => `
                  <div class="case-study-card" ${study.file ? `onclick="openModal('case-${idx}');"` : ''}>
                    ${study.icon ? `<img src="${study.icon}" alt="Icon">` : ''}
                    <h3>${study.heading}</h3>
                    <p>${study.subheading}</p>
                  </div>
                  ${study.file ? `
                    <div id="modal-case-${idx}" class="modal-overlay" onclick="if(event.target === this) closeModal('case-${idx}');">
                      <div class="modal-content">
                        <button class="modal-close" onclick="closeModal('case-${idx}');">Ã—</button>
                        <embed src="${study.file}" type="${study.fileType || 'application/pdf'}" style="width: 100%; height: 85vh;" />
                      </div>
                    </div>
                  ` : ''}
                `).join('')}
              </div>
            </div>
          `;
          
        case 'faq':
          if (section.questions.length === 0) return '';
          return `
            <div id="faq" class="section preview-section" style="background: #f8f9fa;">
              <h2>${section.headline}</h2>
              <p class="subheading">${section.subheading}</p>
              ${section.questions.map((q, idx) => `
                <div class="faq-item">
                  <div class="faq-question" onclick="toggleFAQ(${idx});">
                    ${q.question}
                    <span id="faq-icon-${idx}">â–¼</span>
                  </div>
                  <div class="faq-answer" id="faq-answer-${idx}">${q.answer}</div>
                </div>
              `).join('')}
            </div>
          `;
          
        case 'surprise':
          return `
            <div id="surprise" class="section preview-section">
              <div class="surprise-container">
                <div class="surprise-image">
                  ${section.image ? `<img src="${section.image}" alt="Coffee">` : ''}
                </div>
                <div class="surprise-content">
                  <h2>${section.headline}</h2>
                  <p>${section.subheading}</p>
                  <div class="surprise-form">
                    <div class="surprise-form-row">
                      <input type="text" placeholder="First Name" id="surprise-first">
                      <input type="text" placeholder="Last Name" id="surprise-last">
                    </div>
                    <input type="email" placeholder="Email Address" id="surprise-email">
                    <button onclick="submitSurpriseForm();">Give Me Coffee</button>
                  </div>
                </div>
              </div>
            </div>
          `;
          
        default:
          return '';
      }
    }

    function submitSurpriseForm() {
      const firstName = document.getElementById('surprise-first').value;
      const lastName = document.getElementById('surprise-last').value;
      const email = document.getElementById('surprise-email').value;
      
      if (firstName && lastName && email) {
        const mailtoLink = 'mailto:${state.sections.surprise.email}?subject=Coffee Request&body=First Name: ' + encodeURIComponent(firstName) + '%0D%0ALast Name: ' + encodeURIComponent(lastName) + '%0D%0AEmail: ' + encodeURIComponent(email);
        window.location.href = mailtoLink;
      } else {
        alert('Please fill in all fields');
      }
    }

    function exportWebsite() {
      const visibleSections = state.customization.sectionOrder.filter(
        key => state.customization.sectionVisibility[key]
      );
      
      const exportHTML = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${state.sections.hero.headline} - Precision AQ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Proxima Nova', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      color: #0f1822;
    }
    
    .header {
      position: sticky;
      top: 0;
      background: white;
      padding: 20px 40px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 100;
    }
    .nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }
    .logo {
      height: 40px;
    }
    .menu {
      display: flex;
      gap: 25px;
      flex-wrap: wrap;
    }
    .menu a {
      color: #0f1822;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      transition: color 0.3s;
    }
    .menu a:hover {
      color: #cb009f;
    }
    
    .section {
      padding: 80px 40px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .hero {
      background: linear-gradient(135deg, #cb009f 0%, #850064 100%);
      color: white;
      text-align: center;
      max-width: 100%;
    }
    .hero h1 {
      font-size: 48px;
      margin-bottom: 20px;
      font-weight: bold;
      line-height: 1.2;
    }
    .hero p {
      font-size: 20px;
      margin-bottom: 30px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.6;
    }
    .btn {
      background: white;
      color: #cb009f;
      padding: 14px 32px;
      border-radius: 8px;
      text-decoration: none;
      display: inline-block;
      font-weight: bold;
      font-size: 16px;
      transition: all 0.3s;
      cursor: pointer;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .section h2 {
      font-size: 36px;
      color: #cb009f;
      margin-bottom: 15px;
      font-weight: bold;
    }
    .section .subheading {
      font-size: 18px;
      color: #666;
      margin-bottom: 40px;
      line-height: 1.6;
    }
    
    .team-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 30px;
    }
    .team-card {
      text-align: center;
      padding: 24px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      cursor: pointer;
      transition: all 0.3s;
    }
    .team-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .team-avatar {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: #dcdde1;
      margin: 0 auto 15px;
      overflow: hidden;
    }
    .team-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .team-card h3 {
      color: #cb009f;
      margin-bottom: 5px;
      font-size: 18px;
      font-weight: 600;
    }
    .team-card p {
      color: #666;
      font-size: 14px;
    }
    .team-bio {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #e0e0e0;
      text-align: left;
      font-size: 13px;
      line-height: 1.5;
      color: #666;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .team-card.expanded .team-bio {
      max-height: 500px;
    }
    
    .case-studies-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
    }
    .case-study-card {
      padding: 30px;
      background: #f8f9fa;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      cursor: pointer;
      transition: all 0.3s;
    }
    .case-study-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .case-study-card img {
      width: 60px;
      height: 60px;
      margin-bottom: 15px;
      object-fit: contain;
    }
    .case-study-card h3 {
      color: #cb009f;
      margin-bottom: 12px;
      font-size: 20px;
      font-weight: 600;
    }
    .case-study-card p {
      color: #666;
      font-size: 15px;
      line-height: 1.5;
    }
    
    .faq-item {
      margin-bottom: 15px;
      border: 1px solid #dcdde1;
      border-radius: 8px;
      overflow: hidden;
      background: white;
    }
    .faq-question {
      background: #f8f9fa;
      padding: 20px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 15px;
      color: #333;
      transition: background 0.2s;
    }
    .faq-question:hover {
      background: #e9ecef;
    }
    .faq-answer {
      padding: 20px;
      font-size: 14px;
      color: #666;
      line-height: 1.6;
      display: none;
    }
    .faq-answer.active {
      display: block;
    }
    
    .surprise-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 60px;
      align-items: center;
      max-width: 1000px;
      margin: 0 auto;
    }
    .surprise-image {
      text-align: center;
    }
    .surprise-image img {
      max-width: 100%;
      max-height: 500px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .surprise-content {
      text-align: left;
    }
    .surprise-content h2 {
      font-size: 36px;
      color: #0f1822;
      margin-bottom: 20px;
      text-align: left;
    }
    .surprise-content p {
      font-size: 16px;
      color: #666;
      line-height: 1.6;
      margin-bottom: 30px;
    }
    .surprise-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .surprise-form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    .surprise-form input {
      width: 100%;
      padding: 14px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
    }
    .surprise-form button {
      padding: 16px;
      background: #cb009f;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }
    .surprise-form button:hover {
      background: #850064;
    }
    
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }
    .modal-overlay.active {
      display: flex;
    }
    .modal-content {
      background: white;
      border-radius: 12px;
      max-width: 90%;
      max-height: 90vh;
      overflow: auto;
      position: relative;
      padding: 40px 20px 20px;
    }
    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      font-size: 20px;
      cursor: pointer;
      font-weight: bold;
      z-index: 1;
    }
    .modal-close:hover {
      background: #c82333;
    }
    
    video {
      max-width: 100%;
      border-radius: 12px;
      margin-top: 30px;
    }
    
    @media (max-width: 768px) {
      .hero h1 { font-size: 32px; }
      .hero p { font-size: 16px; }
      .section h2 { font-size: 28px; }
      .surprise-container {
        grid-template-columns: 1fr;
        gap: 30px;
      }
      .surprise-form-row {
        grid-template-columns: 1fr;
      }
      .menu {
        gap: 15px;
      }
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    const state = {
      view: 'home',
      activeSection: 'hero',
      sections: {
        hero: {
          headline: "Thanks for having us!",
          subheading: "It was an honor and a privilege to be able to be considered for your RFP and the time to share our thinking with you. In case you forgot anything we shared, please have a look around.",
          showButton: true,
          buttonText: "Be in Touch",
          buttonLink: "",
          media: null,
          mediaType: null
        },
        pitch: {
          headline: "What we shared with you",
          subheading: "In case you missed it, here's a refresher of what we shared with you in our presentation",
          media: null,
          mediaType: null
        },
        team: {
          headline: "Meet Your Team",
          subheading: "The folks on your side throughout the work",
          people: []
        },
        caseStudies: {
          headline: "Show Your Work",
          subheading: "We have loads of experience and here are some relevant case studies from our recent work",
          studies: []
        },
        faq: {
          headline: "Learn more about Precision AQ",
          subheading: "additional background on Precision AQ and other things",
          questions: []
        },
        surprise: {
          headline: "Know what's keeping you up at night",
          subheading: "With our partnership, you can sleep easy knowing we have your back. Now, the only thing keeping you up will be the coffee!",
          image: null,
          email: ""
        }
      },
      customization: {
        sectionOrder: ['hero', 'pitch', 'team', 'caseStudies', 'faq', 'surprise'],
        sectionVisibility: {
          hero: true,
          pitch: true,
          team: true,
          caseStudies: true,
          faq: true,
          surprise: true
        },
        sectionNames: {
          hero: 'Hero Header',
          pitch: 'Pitch Materials',
          team: 'Team Bios',
          caseStudies: 'Case Studies',
          faq: 'FAQ',
          surprise: 'Surprise & Delight'
        }
      },
      logoBase64: '',
      teamBiosData: [],
      faqFiles: [],
      availableIcons: [],
      modal: null 
    };

    async function loadAssets() {
      try {
        const logoResponse = await fetch('Assets/PAQ-logo.png');
        if (logoResponse.ok) {
          const logoBlob = await logoResponse.blob();
          state.logoBase64 = await new Promise((resolve) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result);
            reader.readAsDataURL(logoBlob);
          });
        }
        
        const coffeeResponse = await fetch('Assets/coffee.png');
        if (coffeeResponse.ok) {
          const coffeeBlob = await coffeeResponse.blob();
          state.sections.surprise.image = await new Promise((resolve) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result);
            reader.readAsDataURL(coffeeBlob);
          });
        }
        
        const csvResponse = await fetch('Assets/Bios/team-bios.csv');
        if (csvResponse.ok) {
          const csvText = await csvResponse.text();
          state.teamBiosData = parseCSV(csvText);
        }
        
        try {
          const faqFiles = ['peanuts-faq.json', 'precision-aq-faq.json'];
          for (const file of faqFiles) {
            try {
              const response = await fetch(`Assets/FAQs/${file}`);
              if (response.ok) {
                state.faqFiles.push({ name: file, data: await response.json() });
              }
            } catch (e) {}
          }
        } catch (e) {}
        
        const iconNames = [
          'Add-Circle-Bold.svg', 'Alarm-Bell-Ring.svg', 'Alert-Bell-Notification-2.svg', 
          'Alert-Octagon-1.svg', 'Ampersand.svg', 'Arrange-Letter.svg', 
          'Arrange-List-Descending.svg', 'Arrange-Number-Descending.svg', 'Attachment.svg',
          'Bill-Cross.svg', 'Bin-1.svg', 'Binocular.svg', 'Blood-Bag-Cross.svg',
          'Book-Close-Bookmark-1.svg', 'Book-Open-Bookmark.svg', 'Bookmark-Cancel-Delete.svg',
          'Bookmarks-Document.svg', 'Branch-Line-5.svg', 'Brightness.svg',
          'Button-Fast-Forward-1.svg', 'Button-Loop.svg', 'Button-Play.svg',
          'Button-Stop.svg', 'Button-Zigzag-1.svg', 'Calendar-3.svg',
          'Calendar-Edit-1.svg', 'Cell-Border-Frame.svg', 'Check-Badge.svg',
          'Check-Double.svg', 'Check-Square.svg', 'Checklist.svg',
          'Checkup-Chart.svg', 'Coding-Apps-Website-Web-Form-Text-Area-1.svg',
          'Cog-Hand-Give-1.svg', 'Cog-Search-1.svg', 'Cog.svg',
          'Command-Button-Keyboard.svg', 'Cursor-Hand-2.svg', 'Cursor-Speed-2.svg',
          'Cursor-Target-1.svg', 'Cursor.svg', 'Delete-2.svg', 'Delete.svg',
          'Diagnostic-Desktop.svg', 'Dial-Finger-1.svg', 'Dial-Pad.svg',
          'Direction-Button-2.svg', 'Direction-Button-3.svg', 'Division-Math-Symbol-Circle.svg',
          'Duplicate.svg', 'Equal-Math-Symbol-Circle.svg', 'Expand-2.svg',
          'Expand-Full.svg', 'Face-Id-1.svg', 'Filter-1.svg',
          'Filter-Sort-Lines-Descending.svg', 'Gauge-Dashboard.svg', 'Hand-Drag.svg',
          'Hospital-Building-Pin.svg', 'Hospital-Sign.svg', 'Insurance-Hand.svg',
          'Insurance-Head.svg', 'Iris-Scan-1.svg', 'Lab-Tube-Experiment.svg',
          'Lab-Tube.svg', 'Lock-Shield.svg', 'Lock-Unlock-4.svg', 'Login-Key.svg',
          'Medical-App-Laptop-1.svg', 'Medical-Specialty-Knee-1.svg', 'Megaphone.svg',
          'Multiple-Users-1.svg', 'Multiple-Users-Network.svg', 'Paper-Write.svg',
          'Pen-Write.svg', 'Pencil-1.svg', 'Petri-Dish-2.svg', 'Plus-One-Increment.svg',
          'Radioactive-Circle.svg', 'Radiology-Scan-Doctor.svg', 'Satellite.svg',
          'Science-Molecule-Strucutre.svg', 'Science-Molecule.svg', 'Search-Circle.svg',
          'Settings-Slider-Desktop-Horizontal.svg', 'Share.svg', 'Shrink.svg',
          'Skull-1.svg', 'Stopwatch.svg', 'Synchronize-Arrows-Three.svg',
          'Tags-Favorite.svg', 'Time-Clock-Fire.svg', 'Time-Daily-1.svg',
          'Tool-Box.svg', 'User-Question.svg', 'User-Signal-1.svg',
          'View-Square.svg', 'Voice-Id-Approved.svg', 'Voice-Id.svg', 'Wifi-Signal-2.svg'
        ];
        
        state.availableIcons = iconNames;
        
      } catch (e) {
        console.log('Some assets not found');
      }
      render();
    }

    function parseCSV(text) {
      const lines = text.trim().split('\n');
      const headers = lines[0].split(',').map(h => h.trim());
      return lines.slice(1).map(line => {
        const values = line.split(',');
        return headers.reduce((obj, header, index) => {
          obj[header] = values[index]?.trim() || '';
          return obj;
        }, {});
      });
    }

    async function handleFileUpload(file) {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result);
        reader.readAsDataURL(file);
      });
    }

    function updateSection(sectionKey, field, value) {
      state.sections[sectionKey][field] = value;
      render();
    }

    function openModal(content) {
      state.modal = content;
      render();
    }

    function closeModal() {
      state.modal = null;
      render();
    }

    function renderHome() {
      return `
        <div class="home-view">
          <div class="home-content">
            <h1 class="home-title">Precision AQ<br/>Landing Page Builder</h1>
            <p class="home-desc">
              Create customized landing pages for your RFP responses with an intuitive interface. Export as a single, self-contained HTML file.
            </p>
            <button class="home-btn" onclick="state.view='builder'; render();">
              Start A Project
            </button>
          </div>
          <div class="home-footer">Built by Jack</div>
        </div>
      `;
    }

    function renderBuilder() {
      return `
        <div class="builder-view">
          ${renderEditorPanel()}
          ${renderPreviewPanel()}
        </div>
        ${state.modal ? renderModal() : ''}
      `;
    }

    function renderModal() {
      return `
        <div class="modal-overlay" onclick="if(event.target === this) closeModal();">
          <div class="modal-content">
            <button class="modal-close" onclick="closeModal();">Ã—</button>
            ${state.modal}
          </div>
        </div>
      `;
    }

    function renderEditorPanel() {
      return `
        <div class="editor-panel">
          <div class="editor-header">
            <h2 class="editor-title">Website Builder</h2>
            <p class="editor-subtitle">Edit your landing page sections below</p>
          </div>
          ${renderTabs()}
          ${renderActiveEditor()}
        </div>
      `;
    }

    function renderTabs() {
      const tabs = ['hero', 'pitch', 'team', 'caseStudies', 'faq', 'surprise', 'customization'];
      return `
        <div class="tabs">
          ${tabs.map(tab => `
            <button class="tab ${state.activeSection === tab ? 'active' : ''}" 
                    onclick="state.activeSection='${tab}'; render();">
              ${tab === 'customization' ? 'Customize & Export' : state.customization.sectionNames[tab]}
            </button>
          `).join('')}
        </div>
      `;
    }

    function renderActiveEditor() {
      switch(state.activeSection) {
        case 'hero': return renderHeroEditor();
        case 'pitch': return renderPitchEditor();
        case 'team': return renderTeamEditor();
        case 'caseStudies': return renderCaseStudiesEditor();
        case 'faq': return renderFaqEditor();
        case 'surprise': return renderSurpriseEditor();
        case 'customization': return renderCustomizationEditor();
        default: return '';
      }
    }

    function renderHeroEditor() {
      const section = state.sections.hero;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Hero Section</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}" 
                   onblur="updateSection('hero', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea" 
                      onblur="updateSection('hero', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" class="form-checkbox" ${section.showButton ? 'checked' : ''}
                     onchange="updateSection('hero', 'showButton', this.checked);">
              <span>Show Call-to-Action Button</span>
            </label>
          </div>
          
          ${section.showButton ? `
            <div class="form-group">
              <label class="form-label">Button Text</label>
              <input type="text" class="form-input" value="${section.buttonText}"
                     onblur="updateSection('hero', 'buttonText', this.value);">
            </div>
            
            <div class="form-group">
              <label class="form-label">Button Link URL</label>
              <input type="url" class="form-input" value="${section.buttonLink}" placeholder="https://example.com"
                     onblur="updateSection('hero', 'buttonLink', this.value);">
            </div>
          ` : ''}
          
          <div class="form-group">
            <label class="form-label">Hero Image/Video (.mp4)</label>
            <input type="file" class="form-input" accept="image/*,video/mp4"
                   onchange="handleHeroMedia(this);">
            ${section.media ? '<p style="margin-top: 8px; font-size: 12px; color: #45b000;">âœ“ Media uploaded</p>' : ''}
          </div>
        </div>
      `;
    }

    async function handleHeroMedia(input) {
      if (input.files[0]) {
        const file = input.files[0];
        const base64 = await handleFileUpload(file);
        state.sections.hero.media = base64;
        state.sections.hero.mediaType = file.type;
        render();
      }
    }

    function renderPitchEditor() {
      const section = state.sections.pitch;
      return `
        <div>
          <h3 style="color: #850064; margin-bottom: 24px; font-size: 22px;">Pitch Materials</h3>
          
          <div class="form-group">
            <label class="form-label">Headline</label>
            <input type="text" class="form-input" value="${section.headline}"
                   onblur="updateSection('pitch', 'headline', this.value);">
          </div>
          
          <div class="form-group">
            <label class="form-label">Subheading</label>
            <textarea class="form-textarea"
                      onblur="updateSection('pitch', 'subheading', this.value);">${section.subheading}</textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">Presentation Materials (PDF or PowerPoint only)</label>
            <input type="file" class="form-input" accept=".pdf,.
